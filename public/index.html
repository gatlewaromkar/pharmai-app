<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmAI - Intelligent Pharmacy Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Outfit:wght@100;300;400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap');

        :root {
            --primary: #38bdf8;
            --primary-glow: rgba(56, 189, 248, 0.5);
            --secondary: #7dd3fc;
            --accent-sky: #0ea5e9;
            --accent-cyan: #06b6d4;
            --error: #ff2d55;
            --error-glow: rgba(255, 45, 85, 0.4);
            --clinical-dark: #0f172a;
            --glass-bg: rgba(15, 23, 42, 0.75);
            --glass-border: rgba(56, 189, 248, 0.15);
            --text-vibrant: #f8fafc;
            --text-dim: #94a3b8;
            --medical-teal: #38bdf8;
            --accent-purple: #a78bfa;
        }

        @keyframes pulse-height {

            0%,
            100% {
                transform: scaleY(1);
            }

            50% {
                transform: scaleY(0.7);
                opacity: 0.8;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Outfit', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0c4a6e 100%);
            color: var(--text-vibrant);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- UNIQUE MEDICAL BACKGROUND (HEARTBEAT GRID) --- */
        .bg-grid {
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(rgba(13, 148, 136, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(13, 148, 136, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: -2;
        }

        .heartbeat-line {
            position: fixed;
            top: 50%;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            z-index: -1;
            box-shadow: 0 0 20px var(--primary);
            animation: moveHeartbeat 6s linear infinite;
            filter: blur(1px);
        }

        @keyframes moveHeartbeat {
            0% {
                left: -100%;
                opacity: 0;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                left: 100%;
                opacity: 0;
            }
        }

        /* --- BENTO GRID LAYOUT --- */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-gap: 20px;
            margin-bottom: 40px;
        }

        /* --- POWERFUL GLASSMORPHISM (MEDICAL GRADE) --- */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(40px) saturate(200%);
            -webkit-backdrop-filter: blur(40px) saturate(200%);
            border: 1px solid var(--glass-border);
            border-radius: 40px;
            padding: 35px;
            transition: all 0.8s cubic-bezier(0.19, 1, 0.22, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }

        .glass-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(56, 189, 248, 0.08), transparent);
            opacity: 0;
            transition: 0.8s;
        }

        .glass-card:hover {
            transform: scale(1.02) translateY(-10px);
            border-color: rgba(56, 189, 248, 0.4);
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.6), 0 0 40px var(--primary-glow);
        }

        .glass-card:hover::before {
            opacity: 1;
        }

        /* --- BIO-GLOW BUTTONS --- */
        .medical-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #000;
            padding: 18px 35px;
            border-radius: 20px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 0.75rem;
            border: none;
            cursor: pointer;
            transition: 0.5s;
            box-shadow: 0 10px 30px var(--primary-glow);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .medical-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 20px 50px var(--primary-glow);
            filter: brightness(1.2);
        }

        /* --- AGENT TERMINALS --- */
        .agent-terminal {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid var(--glass-border);
            border-left: 10px solid var(--primary);
            border-radius: 25px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 25px;
            position: relative;
            transition: 0.5s;
        }

        .agent-terminal:hover {
            border-color: var(--primary);
            box-shadow: 0 0 30px var(--primary-glow);
        }

        .agent-avatar {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, var(--medical-teal), transparent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .agent-avatar::after {
            content: '';
            position: absolute;
            inset: -5px;
            border: 2px dashed var(--medical-teal);
            border-radius: 50%;
            animation: spin 10s linear infinite;
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }

        .agent-status-dot {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 15px;
            height: 15px;
            background: var(--medical-emerald);
            border-radius: 50%;
            border: 2px solid var(--bg-obsidian);
            box-shadow: 0 0 10px var(--medical-emerald);
        }

        .agent-thought {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--medical-emerald);
            opacity: 0.8;
        }

        /* --- HEADER & NAVIGATION --- */
        header {
            background: rgba(2, 6, 23, 0.7);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border-glass);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        .nav-link {
            padding: 10px 20px;
            border-radius: 30px;
            color: var(--text-muted);
            font-weight: 600;
            transition: 0.3s;
            cursor: pointer;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(13, 148, 136, 0.1);
            color: var(--medical-emerald);
            box-shadow: inset 0 0 10px rgba(13, 148, 136, 0.2);
        }

        /* --- SCANNING EFFECT --- */
        @keyframes scan {
            0% {
                top: 0;
            }

            50% {
                top: 100%;
            }

            100% {
                top: 0;
            }
        }

        .scan-overlay::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, transparent 45%, var(--medical-teal) 50%, transparent 55%);
            background-size: 100% 10px;
            opacity: 0.1;
            pointer-events: none;
            animation: scan 10s linear infinite;
        }

        input:focus,
        select:focus {
            box-shadow: 0 0 15px var(--bio-glow);
            border-color: var(--medical-teal) !important;
        }

        /* --- ROLE SPECIFIC --- */
        body:not(.show-patient) .role-patient,
        body:not(.show-doctor) .role-doctor,
        body:not(.show-supplier) .role-supplier {
            display: none !important;
        }

        /* Header Specific Flex Alignment */
        header .role-patient,
        header .role-doctor,
        header .role-supplier {
            display: none !important;
        }

        .show-patient header .role-patient,
        .show-doctor header .role-doctor,
        .show-supplier header .role-supplier {
            display: flex !important;
        }

        /* --- SECTIONAL AI AGENTS --- */
        .section-agent {
            background: linear-gradient(135deg, rgba(20, 184, 166, 0.05), rgba(16, 185, 129, 0.1));
            border: 1px solid rgba(20, 184, 166, 0.2);
            border-left: 4px solid var(--medical-teal);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .section-agent::after {
            content: '';
            position: absolute;
            right: -20px;
            bottom: -20px;
            width: 100px;
            height: 100px;
            background: var(--medical-teal);
            filter: blur(80px);
            opacity: 0.1;
        }

        .agent-chip {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-clinical);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: 0.3s;
        }

        .agent-chip:hover {
            background: var(--medical-teal);
            border-color: var(--medical-teal);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(13, 148, 136, 0.3);
        }

        .medical-btn {
            background: var(--medical-teal);
            color: white;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(13, 148, 136, 0.3);
            transition: 0.3s;
        }

        .medical-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(13, 148, 136, 0.4);
            filter: brightness(1.1);
        }

        #roleOverlay {
            position: fixed;
            inset: 0;
            background: rgba(2, 6, 23, 0.95);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.6s cubic-bezier(0.19, 1, 0.22, 1);
        }

        #roleOverlay .glass-card:hover {
            border-color: var(--medical-teal);
            box-shadow: 0 0 50px rgba(13, 148, 136, 0.2);
            transform: translateY(-10px) scale(1.05);
        }

        /* --- GLASS CHIPS --- */
        .agent-status {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 800;
        }

        .agent-chip {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.7rem;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: 0.3s;
        }

        .agent-chip:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            box-shadow: 0 0 15px var(--primary-glow);
        }

        /* --- MISSION CONTROL HUD --- */
        .hud-stat {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 100;
            display: flex;
            gap: 20px;
            pointer-events: none;
        }

        .hud-badge {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 0.6rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }

        .hud-badge i {
            font-size: 0.8rem;
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                opacity: 1;
                filter: brightness(1);
            }

            50% {
                opacity: 0.5;
                filter: brightness(1.5);
            }
        }

        .news-ticker {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(2, 6, 23, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--glass-border);
            padding: 8px 0;
            z-index: 99;
            overflow: hidden;
            white-space: nowrap;
        }

        .ticker-wrapper {
            display: inline-block;
            animation: ticker 30s linear infinite;
        }

        .ticker-item {
            display: inline-block;
            margin-right: 50px;
            font-size: 0.65rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-dim);
        }

        .ticker-item span {
            color: var(--secondary);
        }

        @keyframes ticker {
            0% {
                transform: translateX(100vw);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        /* --- VOICE COMMAND PULSE --- */
        .voice-pulse {
            position: absolute;
            inset: -10px;
            border: 2px solid var(--primary);
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
        }

        .voice-active .voice-pulse {
            animation: voice-ripple 1.5s infinite ease-out;
        }

        @keyframes voice-ripple {
            0% {
                transform: scale(1);
                opacity: 0.8;
            }

            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* --- ANATOMY VIEWER --- */
        .anatomy-svg {
            width: 100%;
            height: auto;
            max-height: 500px;
            filter: drop-shadow(0 0 20px rgba(0, 242, 254, 0.2));
        }

        .organ-path {
            fill: rgba(255, 255, 255, 0.05);
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 1px;
            transition: all 0.5s ease;
        }

        .organ-highlight {
            fill: var(--primary-glow);
            stroke: var(--primary);
            filter: drop-shadow(0 0 10px var(--primary));
            animation: organ-pulse 2s infinite alternate;
        }

        @keyframes organ-pulse {
            from {
                opacity: 0.4;
            }

            to {
                opacity: 1;
            }
        }

        /* --- BIO-THREAT MAP --- */
        .threat-map {
            background: url('https://upload.wikimedia.org/wikipedia/commons/e/ec/World_map_blank_without_borders.svg') no-repeat center;
            background-size: contain;
            height: 400px;
            position: relative;
            filter: invert(1) opacity(0.2) sepia(1) saturate(5) hue-rotate(140deg);
        }

        .map-anchor {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--primary);
            border-radius: 50%;
            box-shadow: 0 0 20px var(--primary);
            animation: map-pulse 2s infinite;
        }

        .threat-active {
            background: #f43f5e;
            box-shadow: 0 0 20px #f43f5e;
        }

        @keyframes map-pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            100% {
                transform: scale(3);
                opacity: 0;
            }
        }

        /* --- HEALTH VAULT --- */
        .vault-record {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .vault-record:hover {
            background: rgba(20, 184, 166, 0.05);
            border-color: rgba(20, 184, 166, 0.2);
            transform: translateX(10px);
        }

        .encryption-matrix {
            font-family: 'JetBrains Mono', monospace;
            font-size: 8px;
            color: var(--medical-teal);
            opacity: 0.3;
        }

        /* === MOBILE RESPONSIVE IMPROVEMENTS === */
        @media (max-width: 768px) {
            .stat-num {
                font-size: 2rem !important;
            }

            .glass-card {
                padding: 1.5rem !important;
            }

            h1 {
                font-size: 2.5rem !important;
            }

            h3 {
                font-size: 1.5rem !important;
            }

            #chatWidget {
                width: 95vw !important;
                height: 70vh !important;
                bottom: 1rem !important;
                right: 1rem !important;
            }

            .agent-terminal {
                padding: 1rem !important;
            }

            .section-agent {
                flex-direction: column;
                text-align: center;
            }

            .agent-avatar {
                margin: 0 auto 1rem;
            }

            /* Hide background orbs on mobile for performance */
            /* Fixed via JS particle count reduction */
            /* .fixed.inset-0.z-\\[-2\\] {
                display: none;
            } */
        }

        @media (max-width: 480px) {
            .stat-num {
                font-size: 1.5rem !important;
            }

            h1 {
                font-size: 2rem !important;
            }

            .medical-btn {
                padding: 12px 20px !important;
                font-size: 0.65rem !important;
            }
        }
    </style>
</head>

<body class="show-patient">
    <!-- Futuristic Animated Background -->
    <div class="fixed inset-0 z-[-2] overflow-hidden">
        <!-- Gradient Orbs -->
        <div class="absolute top-20 left-10 w-96 h-96 bg-sky-500/20 rounded-full blur-3xl animate-pulse"></div>
        <div class="absolute bottom-20 right-10 w-96 h-96 bg-cyan-500/20 rounded-full blur-3xl animate-pulse"
            style="animation-delay: 2s;"></div>
        <div class="absolute top-1/2 left-1/2 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl animate-pulse"
            style="animation-delay: 4s;"></div>
    </div>

    <!-- Background Effects -->
    <div class="bg-grid"></div>
    <canvas id="neuralCanvas" class="fixed inset-0 z-[-1] opacity-40"></canvas>
    <div class="heartbeat-line" style="top: 30%; animation-delay: 0s;"></div>
    <div class="heartbeat-line" style="top: 70%; animation-delay: 4s;"></div>
    <div class="heartbeat-line" style="top: 50%; animation-delay: 2s; opacity:0.3;"></div>

    <div class="hud-stat">
        <div class="hud-badge">
            <i class="fas fa-microchip"></i>
            <span>CPU 4.2GHz // OPTIMAL</span>
        </div>
        <div class="hud-badge">
            <i class="fas fa-network-wired"></i>
            <span>Neural Link // SECURE</span>
        </div>
        <div class="hud-badge text-emerald-400">
            <i class="fas fa-shield-halved"></i>
            <span>Encrypted Protocol</span>
        </div>
    </div>

    <div class="news-ticker">
        <div class="ticker-wrapper">
            <div class="ticker-item"><span>ALERT:</span> New interaction pattern detected in Cardiology archives.</div>
            <div class="ticker-item"><span>STOCK:</span> Metformin supply stabilizing (+) 4.2%</div>
            <div class="ticker-item"><span>RECORDS:</span> 142 Neural IDs synced via Global Grounding layer.</div>
            <div class="ticker-item"><span>SYS:</span> PharmaI OS X-1 Kernel running at peak clinical efficiency.</div>
            <div class="ticker-item"><span>NEWS:</span> FDA approves next-gen genomic sequencing for bio-markers.</div>
        </div>
    </div>

    <!-- Role Selection Overlay (Clinical Theme) -->
    <div id="roleOverlay" class="flex items-center justify-center">
        <div class="text-center animate__animated animate__fadeIn max-w-6xl w-full px-8">
            <div class="mb-16">
                <div
                    class="inline-flex items-center gap-3 px-4 py-2 bg-teal-500/10 border border-teal-500/20 rounded-full mb-6">
                    <span class="w-2 h-2 bg-teal-500 rounded-full animate-pulse"></span>
                    <span class="text-[10px] font-black text-teal-400 uppercase tracking-[0.3em]">Neural Link Status:
                        Standby</span>
                </div>
                <h1 class="text-7xl font-black mb-4 tracking-tighter text-white">PHARMAI <span class="text-teal-400">OS
                        X-1</span></h1>
                <p class="text-slate-500 font-bold uppercase tracking-[0.4em] text-xs">Authorize Mission Critical
                    Protocol</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                <!-- Patient Card -->
                <div class="glass-card holographic cursor-pointer group p-10 text-center"
                    onclick="selectRole('patient')">
                    <div
                        class="absolute inset-0 bg-gradient-to-b from-teal-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700">
                    </div>
                    <div
                        class="w-24 h-24 bg-teal-500/10 rounded-3xl flex items-center justify-center mx-auto mb-8 group-hover:scale-110 group-hover:bg-teal-500/20 transition-all duration-500 border border-teal-500/10">
                        <i class="fas fa-fingerprint text-4xl text-teal-400"></i>
                    </div>
                    <h3 class="text-2xl font-black mb-4 tracking-tight text-white group-hover:text-teal-400 transition">
                        PATIENT LINK</h3>
                    <p class="text-slate-500 text-sm font-medium leading-relaxed mb-6">Personal wellness monitoring,
                        automated refills & drone-dispatch tracking.</p>
                    <div
                        class="text-[10px] font-black text-teal-500/50 uppercase tracking-widest border border-teal-500/10 py-2 rounded-lg group-hover:border-teal-500/40 group-hover:text-teal-400 transition">
                        Initialize Profile scan</div>
                </div>

                <!-- Clinical Card -->
                <div class="glass-card holographic cursor-pointer group p-10 text-center"
                    onclick="selectRole('doctor')">
                    <div
                        class="absolute inset-0 bg-gradient-to-b from-purple-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700">
                    </div>
                    <div
                        class="w-24 h-24 bg-purple-500/10 rounded-3xl flex items-center justify-center mx-auto mb-8 group-hover:scale-110 group-hover:bg-purple-500/20 transition-all duration-500 border border-purple-500/10">
                        <i class="fas fa-dna text-4xl text-purple-400"></i>
                    </div>
                    <h3
                        class="text-2xl font-black mb-4 tracking-tight text-white group-hover:text-purple-400 transition">
                        CLINICAL HUB</h3>
                    <p class="text-slate-500 text-sm font-medium leading-relaxed mb-6">Advanced diagnostic suite,
                        molecular interaction engine & precision dosage IQ.</p>
                    <div
                        class="text-[10px] font-black text-purple-500/50 uppercase tracking-widest border border-purple-500/10 py-2 rounded-lg group-hover:border-purple-500/40 group-hover:text-purple-400 transition">
                        Authorize Lab Access</div>
                </div>

                <!-- Supply Card -->
                <div class="glass-card holographic cursor-pointer group p-10 text-center"
                    onclick="selectRole('supplier')">
                    <div
                        class="absolute inset-0 bg-gradient-to-b from-blue-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700">
                    </div>
                    <div
                        class="w-24 h-24 bg-blue-500/10 rounded-3xl flex items-center justify-center mx-auto mb-8 group-hover:scale-110 group-hover:bg-blue-500/20 transition-all duration-500 border border-blue-500/10">
                        <i class="fas fa-boxes-stacked text-4xl text-blue-400"></i>
                    </div>
                    <h3 class="text-2xl font-black mb-4 tracking-tight text-white group-hover:text-blue-400 transition">
                        LOGISTICS CORE</h3>
                    <p class="text-slate-500 text-sm font-medium leading-relaxed mb-6">Global inventory grounding,
                        supply chain forecasting & fiscal clearance hub.</p>
                    <div
                        class="text-[10px] font-black text-blue-500/50 uppercase tracking-widest border border-blue-500/10 py-2 rounded-lg group-hover:border-blue-500/40 group-hover:text-blue-400 transition">
                        Sync Market Data</div>
                </div>
            </div>

            <div class="mt-20 opacity-20 hover:opacity-100 transition duration-1000">
                <p class="text-[9px] font-black text-slate-500 uppercase tracking-[0.8em]">End-to-End Encrypted Neural
                    Uplink // AES-2048 Bio-Lock</p>
            </div>
        </div>
    </div>

    <!-- Modern Header -->
    <header class="py-4 px-8 flex justify-between items-center shadow-2xl scan-overlay">
        <div class="flex items-center gap-4">
            <div
                class="w-12 h-12 bg-gradient-to-br from-teal-400 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg shadow-teal-500/20">
                <i class="fas fa-microchip text-white text-xl"></i>
            </div>
            <div>
                <h2 class="font-black text-2xl tracking-tighter text-white">PHARMAI <span class="text-teal-400">OS
                        X-1</span></h2>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 bg-emerald-500 rounded-full animate-ping"></span>
                    <span class="text-[10px] uppercase font-black text-teal-500/80" id="currentRoleLabel">Clinical
                        Standby</span>
                </div>
            </div>
        </div>
        <nav class="hidden md:flex gap-4">
            <a onclick="showSection('dashboard')" class="nav-link px-6 py-2">HUB</a>
            <div class="role-patient flex gap-4">
                <a onclick="showSection('orders')" class="nav-link">TRACKING</a>
                <a onclick="showSection('services')" class="nav-link">PROTOCOLS</a>
            </div>
            <div class="role-doctor flex gap-4">
                <a onclick="showSection('prescriptions')" class="nav-link">RX VISION</a>
                <a onclick="showSection('interactions')" class="nav-link">INTERACTION LAB</a>
                <a onclick="showSection('dosage')" class="nav-link">DOSAGE IQ</a>
                <a onclick="showSection('billing')" class="nav-link">CLEARANCE</a>
            </div>
            <div class="role-supplier flex gap-4">
                <a onclick="showSection('inventory')" class="nav-link">STOCKS</a>
                <a onclick="showSection('billing')" class="nav-link">FINANCE</a>
            </div>
        </nav>
        <div class="flex items-center gap-6">
            <!-- Working Clock -->
            <div class="glass-card px-4 py-2 border-white/10">
                <div class="flex items-center gap-3">
                    <i class="fas fa-clock text-teal-400"></i>
                    <div>
                        <div id="liveTime" class="text-white text-sm font-black font-mono"></div>
                        <div id="liveDate" class="text-slate-500 text-[10px] font-bold uppercase tracking-wider"></div>
                    </div>
                </div>
            </div>

            <button onclick="openRolePortal()"
                class="text-[10px] font-black text-slate-500 hover:text-white transition tracking-widest flex items-center gap-2">
                <i class="fas fa-fingerprint text-teal-400"></i> PORTAL SWITCH
            </button>
            <div class="w-10 h-10 rounded-xl bg-slate-800 border border-white/10 p-1">
                <img src="https://ui-avatars.com/api/?name=Bio&background=00f2fe&color=fff" class="rounded-lg"
                    alt="Profile">
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 pt-32 pb-12">
        <!-- Dashboard (Central Hub) -->
        <section id="dashboard" class="animate__animated animate__fadeIn">
            <!-- Strategic Overseer Agent (Cortex Hub) -->
            <div class="section-agent holographic">
                <div class="agent-avatar"><i class="fas fa-brain text-teal-400"></i>
                    <div class="agent-status-dot"></div>
                </div>
                <div class="flex-1">
                    <h4 class="text-xs font-black text-teal-500 uppercase tracking-widest mb-1">Cortex Strategic
                        Overseer
                    </h4>
                    <p class="text-slate-400 text-sm">"Neural Link Alpha established. Monitoring planetary
                        bio-fluctuations
                        and system efficiency. Current Bio-Sovereignty: 100%."</p>
                    <div class="flex gap-2 mt-3">
                        <span class="agent-chip" onclick="quickChat('Run full system security audit')">System
                            Audit</span>
                        <span class="agent-chip" onclick="quickChat('Predict global health trends for Q1 2026')">Trend
                            Forecast</span>
                        <span class="agent-chip" onclick="quickChat('Optimize inter-node logistics')">Stock Sync</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- Greeting & Agents -->
                <div class="lg:col-span-2 glass-card p-8">
                    <div class="role-patient">
                        <div class="flex justify-between items-start">
                            <div>
                                <h1 class="text-6xl font-black mb-4 tracking-tighter">Hello, <span
                                        class="text-teal-500">Sir!</span></h1>
                                <p class="text-slate-400 text-lg mb-8">Personal Wellness Adherence: <span
                                        class="text-emerald-400">94.2%</span>. Your neural profile is optimized.</p>
                            </div>
                            <div
                                class="glass-card p-4 border-emerald-500/20 bg-emerald-500/5 animate-pulse rounded-2xl">
                                <p class="text-[8px] font-black text-emerald-500 uppercase tracking-widest mb-1">
                                    Adherence
                                    Watchdog</p>
                                <p class="text-[10px] text-white font-bold italic">"Next dose in 2h 15m. Stay hydrated."
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="role-doctor">
                        <div class="flex justify-between items-start">
                            <div>
                                <h1 class="text-6xl font-black mb-4 tracking-tighter text-purple-400">Clinical <span
                                        class="text-white">Suite</span></h1>
                                <p class="text-slate-400 text-lg mb-8">Neural diagnostic engine parsing 142 patient
                                    threads.
                                    No conflicts detected.</p>
                            </div>
                            <div class="glass-card p-4 border-purple-500/20 bg-purple-500/5 rounded-2xl">
                                <p class="text-[8px] font-black text-purple-500 uppercase tracking-widest mb-1">Cortex
                                    Auditor</p>
                                <p class="text-[10px] text-white font-bold italic">"Ready for high-precision bond
                                    simulation."</p>
                            </div>
                        </div>
                    </div>
                    <div class="role-supplier">
                        <div class="flex justify-between items-start">
                            <div>
                                <h1 class="text-6xl font-black mb-4 tracking-tighter text-blue-400">Logic <span
                                        class="text-white">Command</span></h1>
                                <p class="text-slate-400 text-lg mb-8">Global market grounding active. Stock volatility:
                                    <span class="text-emerald-400">LOW</span>.
                                </p>
                            </div>
                            <div class="glass-card p-4 border-blue-500/20 bg-blue-500/5 rounded-2xl">
                                <p class="text-[8px] font-black text-blue-500 uppercase tracking-widest mb-1">Market
                                    Oracle
                                </p>
                                <p class="text-[10px] text-white font-bold italic">"Price dip detected for Raw API Node
                                    Gamma."</p>
                            </div>
                        </div>
                    </div>

                    <!-- Professional AI Agents -->
                    <!-- Patient: Wellness Concierge -->
                    <div class="agent-terminal role-patient p-6 glass-card border-white/5 holographic">
                        <div class="agent-avatar"><i class="fas fa-heart-pulse text-teal-400"></i>
                            <div class="agent-status-dot"></div>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-[10px] font-black uppercase tracking-widest text-teal-500 mb-1">Wellness
                                Concierge</h4>
                            <p class="text-slate-400 text-xs">"I am monitoring your bio-rhythms. Hydration and rest are
                                optimal."</p>
                            <div class="flex gap-2 mt-4">
                                <span class="agent-chip" onclick="quickChat('Show my health adherence report')">Health
                                    Audit</span>
                                <span class="agent-chip" onclick="quickChat('Remind me about my next medication')">Dose
                                    Sync</span>
                            </div>
                        </div>
                    </div>

                    <!-- Doctor: Molecular Synthesizer -->
                    <div class="agent-terminal role-doctor p-6 glass-card border-white/5 holographic">
                        <div class="agent-avatar"><i class="fas fa-atom text-purple-400"></i>
                            <div class="agent-status-dot" style="background:var(--accent-purple)"></div>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-[10px] font-black uppercase tracking-widest text-purple-500 mb-1">Molecular
                                Synthesizer</h4>
                            <p class="text-slate-400 text-xs">"New chemical synergy data detected for Cardiology node."
                            </p>
                            <div class="flex gap-2 mt-4">
                                <span class="agent-chip"
                                    onclick="quickChat('Simulate bond for Aspirin + Metformin')">Model
                                    Bond</span>
                                <span class="agent-chip"
                                    onclick="quickChat('Check for latest clinical trials on diabetes')">Trial
                                    Sync</span>
                            </div>
                        </div>
                    </div>

                    <!-- Supplier: Epidemic Sentinel -->
                    <div class="agent-terminal role-supplier p-6 glass-card border-white/5 holographic">
                        <div class="agent-avatar"><i class="fas fa-biohazard text-blue-400"></i>
                            <div class="agent-status-dot" style="background:#3b82f6"></div>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-[10px] font-black uppercase tracking-widest text-blue-500 mb-1">Epidemic
                                Sentinel</h4>
                            <p class="text-slate-400 text-xs">"Rising influenza demand detected in Asia node. Adjusting
                                stock..."</p>
                            <div class="flex gap-2 mt-4">
                                <span class="agent-chip"
                                    onclick="quickChat('Show global demand spikes for antibiotics')">Threat Map</span>
                                <span class="agent-chip"
                                    onclick="quickChat('Predict inventory needs for Q2 2026')">Demand
                                    Forecast</span>
                            </div>
                        </div>
                    </div>
                    <div class="agent-terminal role-doctor p-6 glass glow-border" style="border-left-color:#a855f7">
                        <div class="agent-avatar" style="border-color:#a855f7"><i
                                class="fas fa-dna text-purple-400"></i>
                            <div class="agent-status-dot" style="background:#a855f7"></div>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-xs font-bold uppercase tracking-widest text-purple-500 mb-1">Cyborg Clinical
                                Lead</h4>
                            <p class="agent-thought text-sm">"Analyzing PubMed for novel drug interaction patterns..."
                            </p>
                            <div class="flex gap-2 mt-4">
                                <span class="agent-chip" onclick="quickChat('Clinical alerts')">Risk Logs</span>
                                <span class="agent-chip" onclick="quickChat('Latest FDA news')">Research Sync</span>
                            </div>
                        </div>
                    </div>
                    <div class="agent-terminal role-supplier p-6 glass glow-border" style="border-left-color:#0ea5e9">
                        <div class="agent-avatar" style="border-color:#0ea5e9"><i
                                class="fas fa-globe text-blue-400"></i>
                            <div class="agent-status-dot" style="background:#0ea5e9"></div>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-xs font-bold uppercase tracking-widest text-blue-500 mb-1">Nexus Logistics
                            </h4>
                            <p class="agent-thought text-sm">"Forecasting potential disruptions in Paracetamol
                                supply..."</p>
                            <div class="flex gap-2 mt-4">
                                <span class="agent-chip" onclick="quickChat('Market trends')">Price Index</span>
                                <span class="agent-chip" onclick="openQuickOrder()">New Dispatch</span>
                            </div>
                        </div>
                    </div>

                    <!-- Dosage IQ Agent -->
                    <div class="agent-terminal role-doctor p-6 mt-6" style="border-left-color: #00f2fe">
                        <div class="agent-avatar" style="border-color: #00f2fe"><i
                                class="fas fa-calculator text-teal-400"></i>
                            <div class="agent-status-dot" style="background:#00f2fe"></div>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-xs font-black text-teal-500 uppercase tracking-widest mb-1">Dosage IQ Agent
                            </h4>
                            <p class="text-slate-400 text-sm">"Renal adjustment protocols and pediatric scaling online."
                            </p>
                            <div class="flex gap-2 mt-3">
                                <span class="agent-chip" onclick="showSection('dosage')">Open Calculator</span>
                                <span class="agent-chip" onclick="quickChat('Calculate dose child Amoxicillin')">Quick
                                    Scale</span>
                            </div>
                        </div>
                    </div>

                    <!-- Genome Lab Agent -->
                    <div class="agent-terminal role-doctor p-6 mt-6 border-emerald-500/20"
                        style="border-left-color: #09f1b8">
                        <div class="agent-avatar" style="border-color: #09f1b8"><i
                                class="fas fa-dna text-emerald-400"></i>
                            <div class="agent-status-dot" style="background:#09f1b8"></div>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-xs font-black text-emerald-500 uppercase tracking-widest mb-1">Genome
                                Bio-Link</h4>
                            <p class="text-slate-400 text-sm">"Analyzing genetic markers for personalized drug
                                efficacy."</p>
                            <div class="flex gap-2 mt-3">
                                <span class="agent-chip" onclick="showSection('genome')">Analyze Markers</span>
                                <span class="agent-chip"
                                    onclick="quickChat('Genetic predisposition for Warfarin')">Pharma-Genome</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Telemetry Card -->
                <div class="glass-card p-10 flex flex-col justify-between text-center relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-4 opacity-5 group-hover:opacity-20 transition">
                        <i class="fas fa-heart-circle-bolt text-8xl"></i>
                    </div>
                    <div>
                        <p class="text-[10px] font-black uppercase tracking-[0.3em] text-teal-500 mb-6">Neural Telemetry
                        </p>
                        <div class="stat-num text-6xl" id="telemetryStat">2,840</div>
                        <p class="text-xs text-slate-500 font-bold mt-2 uppercase">Subject Profiles Synced</p>
                    </div>

                    <div class="mt-8">
                        <div class="flex justify-between items-center mb-2 px-2">
                            <span class="text-[10px] font-bold text-slate-500">THROUGHPUT</span>
                            <span class="text-[10px] font-bold text-emerald-500">OPTIMAL</span>
                        </div>
                        <div
                            class="w-full h-16 bg-slate-900/50 rounded-2xl overflow-hidden flex items-end justify-center p-2 gap-1 border border-white/5">
                            <div class="flex-1 bg-gradient-to-t from-teal-500 to-emerald-400 rounded"
                                style="height:40%; animation: pulse-height 2s infinite ease-in-out;"></div>
                            <div class="flex-1 bg-gradient-to-t from-teal-500 to-emerald-400 rounded"
                                style="height:70%; animation: pulse-height 2.5s infinite ease-in-out 0.2s;"></div>
                            <div class="flex-1 bg-gradient-to-t from-teal-500 to-emerald-400 rounded"
                                style="height:50%; animation: pulse-height 3s infinite ease-in-out 0.4s;"></div>
                            <div class="flex-1 bg-gradient-to-t from-teal-500 to-emerald-400 rounded"
                                style="height:90%; animation: pulse-height 2s infinite ease-in-out 0.1s;"></div>
                            <div class="flex-1 bg-gradient-to-t from-teal-500 to-emerald-400 rounded"
                                style="height:60%; animation: pulse-height 2.8s infinite ease-in-out 0.3s;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bento Stats -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 mb-8">
                <div class="glass-card p-6 text-center group hover:border-emerald-500/50 transition">
                    <i class="fas fa-indian-rupee-sign text-emerald-400 mb-4 text-2xl"></i>
                    <h3 class="stat-num" id="todayRevenue">â‚¹0</h3>
                    <p class="text-slate-500 text-xs font-bold uppercase tracking-widest">Today's Revenue</p>
                </div>
                <div class="glass-card p-6 text-center group hover:border-teal-500/50 transition">
                    <i class="fas fa-boxes text-teal-400 mb-4 text-2xl"></i>
                    <h3 class="stat-num" id="statStock">0</h3>
                    <p class="text-slate-500 text-xs font-bold uppercase tracking-widest">Global Inventory</p>
                </div>
                <div class="glass-card p-6 text-center group hover:border-emerald-500/50 transition">
                    <i class="fas fa-clipboard-check text-emerald-400 mb-4 text-2xl"></i>
                    <h3 class="stat-num">99.8%</h3>
                    <p class="text-slate-500 text-xs font-bold uppercase tracking-widest">AI Precision</p>
                </div>
                <div class="glass-card p-6 text-center group hover:border-yellow-500/50 transition">
                    <i class="fas fa-bolt text-yellow-500 mb-4 text-2xl"></i>
                    <h3 class="stat-num" id="orderCount">0</h3>
                    <p class="text-slate-500 text-xs font-bold uppercase tracking-widest">Active Orders</p>
                </div>
                <div class="glass-card p-6 text-center group hover:border-purple-500/50 transition">
                    <i class="fas fa-microchip text-purple-400 mb-4 text-2xl"></i>
                    <h3 class="stat-num">4.9</h3>
                    <p class="text-slate-500 text-xs font-bold uppercase tracking-widest">Neural Link Latency</p>
                </div>
            </div>
        </section>

        <!-- Prescription Section -->
        <section id="prescriptions" class="role-doctor hidden animate__animated animate__fadeIn">
            <h3 class="text-3xl font-black mb-8"><i class="fas fa-file-medical text-teal-500 mr-2"></i> Clinical
                Verification</h3>

            <!-- Rx Specialist Agent -->
            <div class="section-agent">
                <div class="agent-avatar"><i class="fas fa-eye text-teal-400"></i>
                    <div class="agent-status-dot"></div>
                </div>
                <div class="flex-1">
                    <h4 class="text-xs font-black text-teal-500 uppercase tracking-widest mb-1">Vision-Bio Specialist
                    </h4>
                    <p class="text-slate-400 text-sm">"I can decode handwriting with 99.8% precision. Ready for scan."
                    </p>
                    <div class="flex gap-2 mt-3">
                        <span class="agent-chip" onclick="quickChat('Help me scan Rx')">How to scan?</span>
                        <span class="agent-chip" onclick="quickChat('Common Rx errors')">Log Precautions</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="glass-card p-12 text-center border-2 border-dashed border-teal-500/20 hover:border-teal-500 cursor-pointer"
                    onclick="document.getElementById('rxUpload').click()">
                    <i class="fas fa-upload text-5xl text-teal-400 mb-6 transition group-hover:scale-110"></i>
                    <h4 class="text-xl font-bold mb-2">Upload Prescription</h4>
                    <p class="text-slate-500 mb-6">Neural engine will decode handwritten medicine logs</p>
                    <input type="file" id="rxUpload" class="hidden" onchange="verifyPrescription()">
                    <button class="medical-btn">Launch Scanner</button>
                    <div id="rxResult"
                        class="hidden mt-6 p-6 bg-emerald-500/10 border border-emerald-500/20 rounded-2xl text-emerald-400 font-bold relative overflow-hidden group">
                        <div class="flex items-center justify-between">
                            <span><i class="fas fa-check-circle mr-2"></i> VERIFIED BY AI</span>
                            <button onclick="translateLog()"
                                class="text-[9px] font-black bg-emerald-500/20 hover:bg-emerald-500/40 px-4 py-2 rounded-lg border border-emerald-500/30 transition uppercase tracking-widest">Decipher
                                in Marathi</button>
                        </div>
                        <div id="translatedLog"
                            class="mt-4 text-xs font-medium text-slate-300 hidden border-t border-emerald-500/10 pt-4 animate__animated animate__fadeIn">
                        </div>
                    </div>
                </div>
                <div class="glass-card p-8">
                    <h4 class="font-bold mb-6 text-slate-400 uppercase tracking-widest text-xs">Recent Records</h4>
                    <div class="space-y-4" id="recentPrescriptions">
                        <div
                            class="flex justify-between items-center p-4 bg-slate-900 border border-white/5 rounded-xl">
                            <span class="font-medium">Vikram Singh (Rx-001)</span>
                            <span
                                class="text-xs bg-emerald-500/20 text-emerald-400 px-3 py-1 rounded-full font-bold">ACTIVE</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Inventory Hub -->
        <section id="inventory" class="role-supplier hidden animate__animated animate__fadeIn">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-3xl font-black"><i class="fas fa-warehouse text-blue-500 mr-2"></i> Stock Hub</h3>
                <button onclick="refreshData()"
                    class="text-xs font-bold text-slate-500 hover:text-white transition flex items-center gap-2">
                    <i class="fas fa-sync-alt"></i> SYNC HUB
                </button>
            </div>

            <!-- Stock Sentry Agent -->
            <div class="section-agent" style="border-left-color: #0ea5e9">
                <div class="agent-avatar" style="border-color: #0ea5e9"><i
                        class="fas fa-boxes-stacked text-blue-400"></i>
                    <div class="agent-status-dot" style="background:#0ea5e9"></div>
                </div>
                <div class="flex-1">
                    <h4 class="text-xs font-black text-blue-500 uppercase tracking-widest mb-1">Stock Sentry AI</h4>
                    <p class="text-slate-400 text-sm">"Monitoring expiration cycles and inventory velocity across
                        nodes."</p>
                    <div class="flex gap-2 mt-3">
                        <span class="agent-chip" onclick="initDemandChart()">Real-time Forecast</span>
                        <span class="agent-chip" onclick="quickChat('Show expiry risk nodes')">Risk Analysis</span>
                        <span class="agent-chip" onclick="quickChat('Redistribute stock across nodes')">Neural
                            Logistics</span>
                    </div>
                </div>
            </div>

            <!-- Strategic Analytics Layer -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12">
                <div class="lg:col-span-2 glass-card p-8 holographic relative overflow-hidden">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h4 class="text-xl font-black text-white tracking-tighter">Neural Stock Forecast</h4>
                            <p class="text-[9px] font-black text-slate-500 uppercase tracking-widest mt-1">Global Node
                                Demand Pulse</p>
                        </div>
                        <i class="fas fa-chart-line text-blue-500 text-xl opacity-50"></i>
                    </div>
                    <canvas id="demandChart" style="height:250px; width:100%"></canvas>
                </div>
                <div class="space-y-6">
                    <div class="glass-card p-8 border-blue-500/10">
                        <p class="text-[9px] font-black text-slate-500 uppercase tracking-widest mb-2">Inventory
                            Velocity</p>
                        <h5 class="text-4xl font-black text-white tracking-tighter">92.4 %</h5>
                        <div class="w-full h-1 bg-slate-900 rounded-full mt-4 overflow-hidden">
                            <div class="h-full bg-blue-500" style="width:92.4%"></div>
                        </div>
                    </div>
                    <div class="glass-card p-8 border-rose-500/10">
                        <p class="text-[9px] font-black text-slate-500 uppercase tracking-widest mb-2">Expiry Risk</p>
                        <h5 class="text-4xl font-black text-rose-500 tracking-tighter">04 Nodes</h5>
                        <p class="text-[10px] text-slate-500 mt-2 font-bold italic">"Urgent relocation required for
                            Batch X-92."</p>
                    </div>
                </div>
            </div>

            <div class="glass-card p-0 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-slate-900/50 border-b border-white/5">
                        <tr>
                            <th class="p-6 text-xs font-bold uppercase tracking-widest text-slate-500">Compound Name
                            </th>
                            <th class="p-6 text-xs font-bold uppercase tracking-widest text-slate-500">Unit Price</th>
                            <th class="p-6 text-xs font-bold uppercase tracking-widest text-slate-500">Unit Balance</th>
                            <th class="p-6 text-xs font-bold uppercase tracking-widest text-slate-500">Valuation</th>
                            <th class="p-6 text-xs font-bold uppercase tracking-widest text-slate-500">Expiry Log</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTable"></tbody>
                </table>
            </div>
        </section>

        <!-- Clinical Records (Refined History) -->
        <section id="history" class="role-doctor hidden animate__animated animate__fadeIn">
            <h3 class="text-3xl font-black mb-8 flex items-center gap-3">
                <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center text-purple-400">
                    <i class="fas fa-folder-open"></i>
                </div>
                Patient Intelligence Archives
            </h3>

            <!-- Clinical Archivist Agent -->
            <div class="section-agent" style="border-left-color: #a855f7">
                <div class="agent-avatar" style="border-color: #a855f7"><i
                        class="fas fa-notes-medical text-purple-400"></i>
                    <div class="agent-status-dot" style="background:#a855f7"></div>
                </div>
                <div class="flex-1">
                    <h4 class="text-xs font-black text-purple-500 uppercase tracking-widest mb-1">Cortex Archivist</h4>
                    <p class="text-slate-400 text-sm">"Forensic history retrieval active. Correlating patient patterns."
                    </p>
                    <div class="flex gap-2 mt-3">
                        <span class="agent-chip" onclick="quickChat('Analyze patient trends')">Trend Analysis</span>
                        <span class="agent-chip" onclick="quickChat('Summarize medical history')">Neural Summary</span>
                    </div>
                </div>
            </div>

            <div class="glass-card p-8">
                <div class="flex flex-col md:flex-row gap-4 mb-10">
                    <div class="flex-1 relative">
                        <i class="fas fa-fingerprint absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
                        <input id="historySearch" placeholder="Filter by Biometric ID or Neural Signature..."
                            class="w-full bg-slate-900 border border-white/10 rounded-xl py-4 pl-12 pr-4 outline-none focus:border-purple-500 transition text-sm">
                    </div>
                    <button onclick="fetchHistory()" class="medical-btn px-10" style="background:var(--accent-purple)">
                        <i class="fas fa-dna mr-2"></i> Access Records
                    </button>
                </div>
                <div id="historyList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Advanced History Cards Rendered via JS -->
                </div>
            </div>
        </section>

        <!-- Order Management -->
        <section id="orders" class="role-patient hidden animate__animated animate__fadeIn">
            <h3 class="text-3xl font-black mb-8 flex items-center gap-3">
                <div class="w-12 h-12 bg-teal-500/20 rounded-xl flex items-center justify-center text-teal-400">
                    <i class="fas fa-truck-ramp-box"></i>
                </div>
                Dispatch Intelligence
            </h3>

            <!-- logistics Agent -->
            <div class="section-agent">
                <div class="agent-avatar"><i class="fas fa-truck-plane text-teal-400"></i>
                    <div class="agent-status-dot"></div>
                </div>
                <div class="flex-1">
                    <h4 class="text-xs font-black text-teal-500 uppercase tracking-widest mb-1">Logistics Pilot AI</h4>
                    <p class="text-slate-400 text-sm">"Tracking your biometric dispatch across the drone network."</p>
                    <div class="flex gap-2 mt-3">
                        <span class="agent-chip" onclick="quickChat('Where is my order?')">Track Batch</span>
                        <span class="agent-chip" onclick="quickChat('Delivery ETA')">ETA Sync</span>
                    </div>
                </div>
            </div>

            <div id="ordersBody" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

            <!-- Neural Health Vault -->
            <div class="mt-20">
                <h3 class="text-3xl font-black mb-8 flex items-center gap-3">
                    <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center text-purple-400">
                        <i class="fas fa-vault"></i>
                    </div>
                    Neural Health Vault
                </h3>
                <div class="glass-card p-10 holographic border-white/5 relative overflow-hidden">
                    <div class="absolute -right-10 -bottom-10 opacity-5">
                        <i class="fas fa-shield-halved text-[150px]"></i>
                    </div>
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-12 gap-6">
                        <div>
                            <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-1">Encrypted
                                Biometric Archives</p>
                            <h4 class="text-4xl font-black text-white tracking-tighter">Sovereign Profile <span
                                    class="text-purple-400">Locked</span></h4>
                        </div>
                        <button
                            class="bg-purple-500/10 border border-purple-500/30 text-purple-400 px-8 py-3 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-purple-500/20 transition backdrop-blur-xl">Uplink
                            New Record <i class="fas fa-plus ml-2"></i></button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div
                            class="vault-record p-8 rounded-[30px] flex items-center justify-between group cursor-pointer border border-white/5 bg-slate-900/40">
                            <div class="flex items-center gap-6">
                                <div
                                    class="w-16 h-16 bg-slate-950 rounded-2xl flex items-center justify-center border border-white/5 text-slate-500 group-hover:text-teal-400 transition-all duration-500">
                                    <i class="fas fa-file-waveform text-2xl"></i>
                                </div>
                                <div>
                                    <h5 class="text-xl font-bold text-white mb-1">Blood Synthesis Panel</h5>
                                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Oct 12,
                                        2025 // Node-082</p>
                                </div>
                            </div>
                            <div class="text-right hidden sm:block">
                                <span class="encryption-matrix block mb-1">SHA-256 SECURED</span>
                                <i class="fas fa-lock text-xs text-teal-500"></i>
                            </div>
                        </div>

                        <div
                            class="vault-record p-8 rounded-[30px] flex items-center justify-between group cursor-pointer border border-white/5 bg-slate-900/40">
                            <div class="flex items-center gap-6">
                                <div
                                    class="w-16 h-16 bg-slate-950 rounded-2xl flex items-center justify-center border border-white/5 text-slate-500 group-hover:text-purple-400 transition-all duration-500">
                                    <i class="fas fa-brain text-2xl"></i>
                                </div>
                                <div>
                                    <h5 class="text-xl font-bold text-white mb-1">Neural Synapse Map</h5>
                                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Sep 28,
                                        2025 // Node-014</p>
                                </div>
                            </div>
                            <div class="text-right hidden sm:block">
                                <span class="encryption-matrix block mb-1">AES-256 ENCRYPTED</span>
                                <i class="fas fa-lock text-xs text-purple-500"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Interaction Engine -->
        <section id="interactions" class="role-doctor hidden animate__animated animate__fadeIn">
            <h3 class="text-3xl font-black mb-8 flex items-center gap-3">
                <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center text-purple-400">
                    <i class="fas fa-flask-vial"></i>
                </div>
                Interaction Laboratory
            </h3>

            <!-- Molecular Agent -->
            <div class="section-agent" style="border-left-color: #a855f7">
                <div class="agent-avatar" style="border-color: #a855f7"><i
                        class="fas fa-microscope text-purple-400"></i>
                    <div class="agent-status-dot" style="background:#a855f7"></div>
                </div>
                <div class="flex-1">
                    <h4 class="text-xs font-black text-purple-500 uppercase tracking-widest mb-1">Molecular Bio-Agent
                    </h4>
                    <p class="text-slate-400 text-sm">"Simulating chemical bonds to prevent hazardous synergy events."
                    </p>
                    <div class="flex gap-2 mt-3">
                        <span class="agent-chip" onclick="quickChat('Explain drug interactions')">Science Recap</span>
                        <span class="agent-chip" onclick="quickChat('Hazardous drug combinations')">Danger List</span>
                    </div>
                </div>
            </div>

            <div class="glass-card p-10">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 mb-10">
                    <div class="relative">
                        <label
                            class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-3 block">Molecular
                            Agent ALPHA</label>
                        <div class="relative">
                            <i class="fas fa-atom absolute left-4 top-1/2 -translate-y-1/2 text-teal-500/50"></i>
                            <input id="drug1" oninput="handleInput(this, 'sugg1')" placeholder="Identify substance..."
                                class="w-full bg-slate-950 border border-white/5 rounded-xl py-4 pl-12 pr-4 outline-none focus:border-teal-500 transition">
                        </div>
                        <div id="sugg1"
                            class="hidden absolute mt-2 w-full bg-slate-900 border border-white/10 rounded-xl shadow-2xl z-50 overflow-hidden">
                        </div>
                    </div>
                    <div class="relative">
                        <label
                            class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-3 block">Molecular
                            Agent BETA</label>
                        <div class="relative">
                            <i class="fas fa-atom absolute left-4 top-1/2 -translate-y-1/2 text-teal-500/50"></i>
                            <input id="drug2" oninput="handleInput(this, 'sugg2')" placeholder="Identify substance..."
                                class="w-full bg-slate-950 border border-white/5 rounded-xl py-4 pl-12 pr-4 outline-none focus:border-teal-500 transition">
                        </div>
                        <div id="sugg2"
                            class="hidden absolute mt-2 w-full bg-slate-900 border border-white/10 rounded-xl shadow-2xl z-50 overflow-hidden">
                        </div>
                    </div>
                </div>
                <button onclick="checkDrugInteraction()" class="medical-btn w-full py-5 text-lg">
                    <i class="fas fa-microscope mr-2"></i> Execute Neural Interaction Scan
                </button>
                <div id="aiMeter"
                    class="hidden mt-12 p-12 border border-white/5 rounded-[40px] bg-slate-950/40 relative overflow-hidden holographic">
                    <div class="absolute top-0 right-0 p-8 opacity-5 group-hover:opacity-10 transition">
                        <i class="fas fa-biohazard text-9xl"></i>
                    </div>
                    <div id="riskScore" class="text-center text-6xl font-black mb-8 tracking-tighter text-teal-400">
                        INITIALIZING SCAN...</div>
                    <div class="w-full h-2 bg-slate-900 rounded-full overflow-hidden mb-10 border border-white/5">
                        <div id="riskBar"
                            class="h-full bg-gradient-to-r from-teal-500 to-emerald-500 transition-all duration-1000 shadow-[0_0_20px_var(--primary-glow)]"
                            style="width:0%"></div>
                    </div>
                    <div id="drugResultText" class="text-slate-300"></div>
                </div>

                <!-- Neural Anatomy Subsystem -->
                <div id="anatomySubsystem" class="mt-12 hidden animate__animated animate__fadeIn">
                    <div class="glass-card p-10 holographic border-white/5 relative overflow-hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                            <div class="relative">
                                <h5 class="text-[10px] font-black text-teal-500 uppercase tracking-[0.4em] mb-8">
                                    Physiological Impact Visualization</h5>
                                <!-- Simulated Anatomy SVG -->
                                <svg viewBox="0 0 300 500" class="anatomy-svg">
                                    <path id="body-outline" class="organ-path"
                                        d="M150,20 C180,20 200,40 200,70 L200,100 C230,110 250,130 250,180 L250,450 C250,480 230,480 210,480 L90,480 C70,480 50,480 50,450 L50,180 C50,130 70,110 100,100 L100,70 C100,40 120,20 150,20" />
                                    <circle id="organ-heart" class="organ-path" cx="150" cy="180" r="20" />
                                    <path id="organ-lungs" class="organ-path"
                                        d="M120,150 Q150,130 180,150 Q210,200 180,250 Q150,270 120,250 Q90,200 120,150" />
                                    <path id="organ-liver" class="organ-path"
                                        d="M110,260 L190,260 L170,300 L130,300 Z" />
                                    <path id="organ-brain" class="organ-path"
                                        d="M120,60 Q150,30 180,60 Q200,90 150,110 Q100,90 120,60" />
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-3xl font-black text-white mb-4 tracking-tighter">Bio-Synthetic <span
                                        class="text-teal-400">Anatomy Link</span></h4>
                                <p class="text-slate-400 text-sm leading-relaxed mb-8">Real-time simulation of molecular
                                    pathways across critical biometric nodes. System identifies high-sensitivity
                                    clusters based on current diagnostic inputs.</p>
                                <div id="anatomyDetails" class="space-y-4">
                                    <div class="p-4 bg-white/5 border border-white/10 rounded-xl">
                                        <p class="text-[9px] font-black text-slate-500 uppercase mb-1">Target Cluster
                                        </p>
                                        <h6 class="text-white font-bold" id="targetOrganName">Neural Standby</h6>
                                    </div>
                                    <div class="p-4 bg-white/5 border border-white/10 rounded-xl">
                                        <p class="text-[9px] font-black text-slate-500 uppercase mb-1">Impact
                                            Probability</p>
                                        <h6 class="text-teal-400 font-mono" id="impactProb">0.00%</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Billing Hub -->
        <section id="billing" class="role-doctor role-supplier hidden animate__animated animate__fadeIn">
            <h3 class="text-3xl font-black mb-8 flex items-center gap-3">
                <div class="w-12 h-12 bg-emerald-500/20 rounded-xl flex items-center justify-center text-emerald-400">
                    <i class="fas fa-receipt"></i>
                </div>
                Financial Clearance Hub
            </h3>

            <!-- Fiscal Agent -->
            <div class="section-agent" style="border-left-color: #10b981">
                <div class="agent-avatar" style="border-color: #10b981"><i class="fas fa-coins text-emerald-400"></i>
                    <div class="agent-status-dot" style="background:#10b981"></div>
                </div>
                <div class="flex-1">
                    <h4 class="text-xs font-black text-emerald-500 uppercase tracking-widest mb-1">Fiscal Link Agent
                    </h4>
                    <p class="text-slate-400 text-sm">"Optimizing pricing yields and automating clinical tax protocols."
                    </p>
                    <div class="flex gap-2 mt-3">
                        <span class="agent-chip" onclick="quickChat('Price breakdown')">Protocol Pricing</span>
                        <span class="agent-chip" onclick="quickChat('Apply discount')">Apply Subsidy</span>
                    </div>
                </div>
            </div>

            <div class="glass-card p-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="lg:col-span-2">
                        <label
                            class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 block">Patient
                            Biological Signature</label>
                        <input id="billPatient" placeholder="Neural ID / Name"
                            class="w-full bg-slate-950 border border-white/5 rounded-xl p-4 outline-none focus:border-emerald-500 text-white">
                    </div>
                    <div>
                        <label
                            class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 block">Invoice
                            Protocol</label>
                        <input value="#PH-9920-X"
                            class="w-full bg-slate-900 border border-white/5 rounded-xl p-4 outline-none text-slate-500 font-mono"
                            disabled>
                    </div>
                </div>

                <div class="p-6 bg-slate-950 rounded-2xl border border-white/5 mb-8">
                    <div class="flex flex-col md:flex-row gap-4">
                        <select id="billMedicineSelect"
                            class="flex-[3] bg-slate-900 border border-white/10 rounded-xl p-4 outline-none focus:border-emerald-500 text-white"></select>
                        <input id="billQty" type="number" placeholder="Count"
                            class="flex-1 bg-slate-900 border border-white/10 rounded-xl p-4 outline-none focus:border-emerald-500 text-white">
                        <button onclick="addToBill()"
                            class="bg-emerald-600 text-white px-8 rounded-xl font-bold hover:bg-emerald-500 transition shadow-lg shadow-emerald-500/20">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>

                <table class="w-full mb-8">
                    <thead
                        class="text-left text-[10px] font-black text-slate-500 uppercase tracking-widest border-b border-white/5">
                        <tr>
                            <th class="pb-4">Item Catalog</th>
                            <th class="pb-4 text-right">Price</th>
                            <th class="pb-4 text-center">Unit</th>
                            <th class="pb-4 text-right">Yield</th>
                        </tr>
                    </thead>
                    <tbody id="billTable" class="text-sm"></tbody>
                </table>

                <div class="flex flex-col md:flex-row justify-between items-end border-t border-white/10 pt-8 gap-8">
                    <div class="space-y-2">
                        <p class="text-slate-500 text-sm">Sub-Yield: <span class="text-white font-mono">â‚¹<span
                                    id="subTotal">0</span></span></p>
                        <p class="text-slate-500 text-sm">Clinical Tax (5%): <span class="text-white font-mono">â‚¹<span
                                    id="taxTotal">0</span></span></p>
                        <h4 class="text-4xl font-black text-emerald-400 mt-4 tracking-tighter">â‚¹<span
                                id="grandTotal">0</span></h4>
                    </div>
                    <button onclick="finalizeBill()" class="medical-btn px-12 py-5 text-lg"
                        style="background:var(--medical-emerald)">
                        Seal & Dispatch <i class="fas fa-check-double ml-2"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- Dosage IQ Calculator -->
        <section id="dosage" class="role-doctor hidden animate__animated animate__fadeIn">
            <h3 class="text-3xl font-black mb-8 flex items-center gap-3">
                <div class="w-12 h-12 bg-teal-500/20 rounded-xl flex items-center justify-center text-teal-400">
                    <i class="fas fa-calculator"></i>
                </div>
                Dosage Calibration Lab
            </h3>
            <div class="glass-card p-10 holographic">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                    <div>
                        <label
                            class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 block">Patient
                            Weight (kg)</label>
                        <input type="number" id="doseWeight"
                            class="w-full bg-slate-950 border border-white/5 rounded-xl p-4 outline-none focus:border-teal-500 text-white"
                            placeholder="70">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 block">Drug
                            Protocol</label>
                        <input type="text" id="doseDrug"
                            class="w-full bg-slate-950 border border-white/5 rounded-xl p-4 outline-none focus:border-teal-500 text-white"
                            placeholder="e.g. Paracetamol">
                    </div>
                    <div>
                        <label
                            class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 block">Clinical
                            Condition</label>
                        <select id="doseCondition"
                            class="w-full bg-slate-950 border border-white/5 rounded-xl p-4 outline-none focus:border-teal-500 text-white">
                            <option>Baseline</option>
                            <option>Renal Impairment</option>
                            <option>Hepatic Failure</option>
                            <option>Pediatric</option>
                            <option>Geriatric</option>
                        </select>
                    </div>
                </div>
                <button onclick="calculateDose()" class="medical-btn w-full">Execute Dosage Optimization</button>
                <div id="doseResult"
                    class="mt-8 hidden p-10 bg-slate-900/50 rounded-[30px] border border-teal-500/20 holographic">
                    <!-- JS Injection -->
                </div>
            </div>
        </section>

        <!-- Genome AI Lab -->
        <section id="genome" class="role-doctor hidden animate__animated animate__fadeIn">
            <h3 class="text-3xl font-black mb-8 flex items-center gap-3">
                <div class="w-12 h-12 bg-emerald-500/20 rounded-xl flex items-center justify-center text-emerald-400">
                    <i class="fas fa-helix"></i>
                </div>
                Precision Genomic Station
            </h3>
            <div class="glass-card p-10 relative overflow-hidden holographic">
                <div class="absolute -right-20 -top-20 opacity-5 rotate-12">
                    <i class="fas fa-dna text-[200px]"></i>
                </div>
                <div class="max-w-2xl">
                    <h4 class="text-4xl font-black mb-6 tracking-tighter">Decode Patient <span
                            class="text-emerald-400">Bio-Signature</span></h4>
                    <p class="text-slate-400 mb-10 leading-relaxed">Neural Link is capable of analyzing CYP450
                        polymorphisms to predict drug metabolism speeds. Input specific markers for high-precision
                        simulation.</p>
                    <div class="grid grid-cols-2 gap-4 mb-10">
                        <input id="genomeMarker" placeholder="Target Marker (e.g. CYP2C19)"
                            class="bg-slate-900 border border-white/10 rounded-xl p-4 text-white outline-none focus:border-emerald-500">
                        <button onclick="simulateGenom()" class="medical-btn" style="background:var(--secondary)">Start
                            Simulation</button>
                    </div>
                    <div id="genomeOutput" class="space-y-4"></div>
                </div>
            </div>
        </section>

        <!-- Automated Services -->
        <section id="services" class="role-patient hidden animate__animated animate__fadeIn">
            <h3 class="text-3xl font-black mb-8 flex items-center gap-3">
                <div class="w-12 h-12 bg-teal-500/20 rounded-xl flex items-center justify-center text-teal-400">
                    <i class="fas fa-hand-holding-medical"></i>
                </div>
                Protocol Support Services
            </h3>

            <div class="section-agent">
                <div class="agent-avatar"><i class="fas fa-user-gear text-teal-400"></i>
                    <div class="agent-status-dot"></div>
                </div>
                <div class="flex-1">
                    <h4 class="text-xs font-black text-teal-500 uppercase tracking-widest mb-1">Clinical Protocol Agent
                    </h4>
                    <p class="text-slate-400 text-sm">"Automating your healthcare journey. I can manage drone logistics
                        and tele-cortex links."</p>
                    <div class="flex gap-2 mt-3">
                        <span class="agent-chip" onclick="quickChat('Help me with drone delivery')">Drone Support</span>
                        <span class="agent-chip" onclick="quickChat('Book tele-consultation')">Book Doc</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div
                    class="glass-card p-8 text-center hover:bg-teal-500/5 transition group cursor-pointer border-white/5 holographic">
                    <div
                        class="w-20 h-20 bg-teal-500/10 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition">
                        <i class="fas fa-truck-fast text-3xl text-teal-400"></i>
                    </div>
                    <h4 class="text-xl font-bold mb-3">Hypersonic Link</h4>
                    <p class="text-slate-500 text-sm leading-relaxed">Drone-optimized delivery within 15 minutes of
                        neural clearance.</p>
                </div>
                <div
                    class="glass-card p-8 text-center hover:bg-purple-500/5 transition group cursor-pointer border-white/5 holographic">
                    <div
                        class="w-20 h-20 bg-purple-500/10 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition">
                        <i class="fas fa-video text-3xl text-purple-400"></i>
                    </div>
                    <h4 class="text-xl font-bold mb-3">Tele-Cortex</h4>
                    <p class="text-slate-500 text-sm leading-relaxed">Instant holographic consultation with world-class
                        pharmacists.</p>
                </div>
                <div
                    class="glass-card p-8 text-center hover:bg-emerald-500/5 transition group cursor-pointer border-white/5 holographic">
                    <div
                        class="w-20 h-20 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition">
                        <i class="fas fa-arrows-rotate text-3xl text-emerald-400"></i>
                    </div>
                    <h4 class="text-xl font-bold mb-3">Neural Refill</h4>
                    <p class="text-slate-500 text-sm leading-relaxed">Predicted demand-based restocking for persistent
                        chronic cycles.</p>
                </div>
            </div>
        </section>

        <!-- Partner Compliance -->
        <section id="suppliers" class="role-supplier hidden animate__animated animate__fadeIn">
            <h3 class="text-3xl font-black mb-8 flex items-center gap-3">
                <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center text-blue-400">
                    <i class="fas fa-handshake"></i>
                </div>
                Global Logistics Sovereignty
            </h3>

            <!-- Compliance Guardian Agent -->
            <div class="section-agent" style="border-left-color: #3b82f6">
                <div class="agent-avatar" style="border-color: #3b82f6"><i
                        class="fas fa-scale-balanced text-blue-400"></i>
                    <div class="agent-status-dot" style="background:#3b82f6"></div>
                </div>
                <div class="flex-1">
                    <h4 class="text-xs font-black text-blue-500 uppercase tracking-widest mb-1">Compliance Guardian</h4>
                    <p class="text-slate-400 text-sm">"Monitoring FDA sovereignty and partner protocol alignment in
                        real-time."</p>
                    <div class="flex gap-2 mt-3">
                        <span class="agent-chip" onclick="quickChat('Check compliance status')">Verify Nodes</span>
                        <span class="agent-chip" onclick="quickChat('Update partner protocols')">Policy Sync</span>
                    </div>
                </div>
            </div>

            <div class="glass-card p-10 holographic relative overflow-hidden mb-12">
                <div class="flex justify-between items-center mb-10">
                    <div>
                        <h4 class="text-3xl font-black text-white tracking-tighter">Global <span
                                class="text-blue-400">Bio-Threat</span> Matrix</h4>
                        <p class="text-slate-500 text-xs font-bold uppercase tracking-widest mt-1">Real-time Node
                            Sovereignty & Demand Spikes</p>
                    </div>
                    <div class="flex gap-4">
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-teal-500 animate-pulse"></span>
                            <span class="text-[9px] font-black text-slate-400 uppercase">Stable Node</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-rose-500 animate-pulse"></span>
                            <span class="text-[9px] font-black text-slate-400 uppercase">High Demand</span>
                        </div>
                    </div>
                </div>

                <div class="threat-map mb-10">
                    <div class="map-anchor" style="top:30%; left:20%;"></div> <!-- USA -->
                    <div class="map-anchor threat-active" style="top:45%; left:72%;"></div> <!-- India -->
                    <div class="map-anchor" style="top:35%; left:60%;"></div> <!-- Europe -->
                    <div class="map-anchor" style="top:60%; left:85%;"></div> <!-- Australia -->
                    <div class="map-anchor threat-active" style="top:25%; left:80%;"></div> <!-- NE Asia -->
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                    <div class="p-4 bg-slate-900/50 border border-white/5 rounded-2xl">
                        <p class="text-[9px] font-black text-slate-500 uppercase mb-1">Active Nodes</p>
                        <h6 class="text-xl font-black text-white">2,842</h6>
                    </div>
                    <div class="p-4 bg-slate-900/50 border border-white/5 rounded-2xl">
                        <p class="text-[9px] font-black text-slate-500 uppercase mb-1">Logistics Yield</p>
                        <h6 class="text-xl font-black text-teal-400">98.4%</h6>
                    </div>
                    <div class="p-4 bg-slate-900/50 border border-white/5 rounded-2xl">
                        <p class="text-[9px] font-black text-rose-500 uppercase mb-1">Emerging Threats</p>
                        <h6 class="text-xl font-black text-white">04</h6>
                    </div>
                    <div class="p-4 bg-slate-900/50 border border-white/5 rounded-2xl">
                        <p class="text-[9px] font-black text-slate-500 uppercase mb-1">System Health</p>
                        <h6 class="text-xl font-black text-blue-400">OPTIMAL</h6>
                    </div>
                </div>
            </div>

            <div
                class="glass-card p-12 grid grid-cols-2 md:grid-cols-5 gap-8 items-center justify-items-center opacity-40 hover:opacity-100 transition duration-1000">
                <div class="text-lg font-black tracking-widest text-slate-500">CIPLA <span
                        class="text-[8px] block">NEURAL LINKED</span></div>
                <div class="text-lg font-black tracking-widest text-slate-500">SUN <span
                        class="text-[8px] block">BIO-SYNCED</span></div>
                <div class="text-lg font-black tracking-widest text-slate-500">REDDY'S <span
                        class="text-[8px] block">LOGISTICS HUB</span></div>
                <div class="text-lg font-black tracking-widest text-slate-500">APOLLO <span
                        class="text-[8px] block">RETAIL NODE</span></div>
                <div class="text-lg font-black tracking-widest text-slate-500">FDA <span
                        class="text-[8px] block">PROTOCOL VERIFIED</span></div>
            </div>
        </section>
    </main>

    <!-- PREMIUM FOOTER -->
    <footer class="mt-20 py-12 border-t border-white/5 bg-slate-900/50 backdrop-blur-xl">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">
                <div class="col-span-2">
                    <h2
                        class="text-3xl font-black mb-4 bg-clip-text text-transparent bg-gradient-to-r from-teal-400 to-emerald-500">
                        PharmAI Systems OS</h2>
                    <p class="text-slate-500 max-w-md">The world's most advanced AI-driven pharmaceutical intelligence
                        layer. Streamlining clinical workflows with neural precision.</p>
                </div>
                <div>
                    <h4 class="text-xs font-bold uppercase tracking-widest text-slate-400 mb-6">Neural Portals</h4>
                    <ul class="space-y-4 text-sm text-slate-500">
                        <li><a href="javascript:selectRole('patient')" class="hover:text-teal-400 transition">Patient
                                Interface</a></li>
                        <li><a href="javascript:selectRole('doctor')" class="hover:text-purple-400 transition">Clinical
                                Suite</a></li>
                        <li><a href="javascript:selectRole('supplier')" class="hover:text-blue-400 transition">Logistics
                                Hub</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-xs font-bold uppercase tracking-widest text-slate-400 mb-6">Status</h4>
                    <div class="flex items-center gap-2 text-emerald-500 text-sm font-bold">
                        <span class="w-2 h-2 bg-emerald-500 rounded-full animate-ping"></span>
                        Neural Link: OPTIMIZED
                    </div>
                </div>
            </div>
            <div class="pt-8 border-t border-white/5 text-center text-slate-600 text-xs font-bold tracking-widest">
                &copy; 2025 PHARMAI SYSTEMS. ALL RIGHTS RESERVED. // CREATED BY OMKAR GATLEWAR & SHUBHAM MUNDE
            </div>
        </div>
    </footer>

    <!-- Chat Widget -->
    <div id="chatWidget"
        class="fixed bottom-24 right-8 w-96 h-[600px] glass z-50 hidden flex-col border border-white/10 shadow-2xl animate__animated animate__slideInUp">
        <div class="p-6 border-b border-white/5 flex justify-between items-center bg-slate-900/50">
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 bg-teal-500/20 rounded-full flex items-center justify-center border border-teal-500/30">
                    <i class="fas fa-robot text-teal-400"></i>
                </div>
                <div>
                    <h4 class="text-sm font-bold">Neural Link v4.5</h4>
                    <span class="text-[10px] text-teal-400 font-bold uppercase tracking-widest">Grounded
                        Intelligence</span>
                </div>
            </div>
            <button onclick="toggleChat()" class="text-slate-500 hover:text-white transition"><i
                    class="fas fa-times"></i></button>
        </div>
        <div id="chatMessages" class="flex-1 p-6 overflow-y-auto space-y-4 scroll-smooth bg-slate-950/20">
            <div class="flex justify-start">
                <div class="glass p-4 rounded-2xl rounded-tl-none text-sm max-w-[85%] border-white/5 text-slate-300">
                    System initialized. I am your specialized AI agent for the <span id="chatRoleLabel"
                        class="font-bold text-teal-400">Patient Interface</span>. How can I assist?
                </div>
            </div>
        </div>
        <div class="p-4 border-t border-white/5 bg-slate-900/80">
            <div
                class="flex gap-2 items-center bg-slate-950 border border-white/10 rounded-xl p-2 focus-within:border-teal-500/50 transition">
                <input type="text" id="chatInput" placeholder="Decrypt query..."
                    onkeypress="if(event.key === 'Enter') sendMessage()"
                    class="flex-1 bg-transparent border-none text-sm outline-none text-white p-2">
                <button onclick="sendMessage()"
                    class="w-10 h-10 bg-teal-600 rounded-lg text-white hover:bg-teal-500 transition shadow-lg"><i
                        class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="quickOrderModal"
        class="fixed inset-0 bg-slate-950/80 backdrop-blur-md hidden z-[100] flex items-center justify-center p-4 animate__animated animate__fadeIn">
        <div class="glass-card p-10 max-w-md w-full border-teal-500/30 holographic relative overflow-hidden">
            <div class="absolute -right-10 -top-10 opacity-5">
                <i class="fas fa-truck-dispatch text-[150px]"></i>
            </div>
            <h3 class="text-3xl font-black mb-2 flex items-center gap-3"><i class="fas fa-bolt text-teal-400"></i>
                Neural Dispatch</h3>
            <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-8">Secure Logistics
                Authorization</p>

            <div class="space-y-6">
                <div class="relative">
                    <label class="text-[9px] font-black text-teal-500/50 uppercase tracking-widest mb-2 block">Patient
                        Biological Signature</label>
                    <input id="quickPatient" placeholder="Neural ID / Name"
                        class="w-full bg-slate-950 border border-white/10 rounded-xl p-4 outline-none focus:border-teal-500 text-white transition">
                </div>
                <div class="relative">
                    <label class="text-[9px] font-black text-teal-500/50 uppercase tracking-widest mb-2 block">Molecular
                        Asset Selection</label>
                    <select id="quickMed"
                        class="w-full bg-slate-950 border border-white/10 rounded-xl p-4 outline-none focus:border-teal-500 text-white transition"></select>
                </div>
                <div class="relative">
                    <label class="text-[9px] font-black text-teal-500/50 uppercase tracking-widest mb-2 block">Unit
                        Intensity (Qty)</label>
                    <input type="number" id="quickQty" placeholder="Count"
                        class="w-full bg-slate-950 border border-white/10 rounded-xl p-4 outline-none focus:border-teal-500 text-white transition">
                </div>
                <div class="flex gap-4 mt-12">
                    <button onclick="submitQuickOrder()" class="medical-btn flex-1 py-4">Authorize Dispatch</button>
                    <button onclick="closeQuickOrder()"
                        class="flex-1 text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-white transition">Abort
                        Protocol</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Layer -->
    <div class="fixed bottom-8 right-8 flex flex-col gap-4 z-50">
        <!-- Voice Commander -->
        <button id="voiceBtn" onclick="toggleVoiceCommand()"
            class="w-16 h-16 bg-slate-900 border border-white/10 text-teal-400 rounded-full shadow-2xl hover:scale-110 transition flex items-center justify-center text-2xl relative overflow-visible group">
            <div class="voice-pulse"></div>
            <i class="fas fa-microphone"></i>
            <span
                class="absolute right-20 bg-slate-900 border border-white/10 px-3 py-1 rounded-lg text-[9px] font-black text-teal-400 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition whitespace-nowrap">Voice
                Uplink</span>
        </button>

        <!-- Neural Chat -->
        <button onclick="toggleChat()"
            class="w-16 h-16 bg-gradient-to-br from-teal-500 to-emerald-600 text-white rounded-full shadow-2xl hover:scale-110 transition flex items-center justify-center text-2xl animate-pulse">
            <i class="fas fa-comment-medical"></i>
        </button>
    </div>
    <script>
        const API_URL = '/api';
        let inventory = [];
        let billItems = [];
        let currentRole = 'patient';

        // Navigation function
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('section').forEach(s => {
                s.classList.add('hidden');
                s.classList.remove('animate__fadeIn');
            });

            // Show selected section
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.remove('hidden');
                section.classList.add('animate__fadeIn');

                // Scroll to section
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });

                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('text-teal-400', 'border-b-2', 'border-teal-400');
                });
                event?.target?.classList.add('text-teal-400', 'border-b-2', 'border-teal-400');
            }

            // Special initializations
            if (sectionId === 'inventory' && currentRole === 'supplier') {
                initDemandChart();
            }
        }

        // Role selection function
        function selectRole(role) {
            currentRole = role;

            // Update body class for role-specific styling
            document.body.className = `show-${role}`;

            // Hide role overlay
            document.getElementById('roleOverlay').classList.add('hidden');

            // Update role label
            const labels = {
                'patient': 'Patient Portal',
                'doctor': 'Clinical Director',
                'supplier': 'Logistics Command'
            };
            document.getElementById('currentRoleLabel').innerText = labels[role];

            // Show dashboard
            showSection('dashboard');

            // Load role-specific data
            if (role === 'patient') {
                fetchOrders();
            } else if (role === 'doctor') {
                fetchHistory();
            } else if (role === 'supplier') {
                // Inventory already loaded
            }
        }

        // Open role portal for switching
        function openRolePortal() {
            document.getElementById('roleOverlay').classList.remove('hidden');
        }

        async function init() {
            initNeuralBackground();
            await refreshData();
            await updateDashboard(); // Load real dashboard stats
            selectRole(currentRole); // Ensures body classes and sections are initialized
            initTelemetryFluctuation();
            showToast('Neural Link Active', 'success');
        }

        function initTelemetryFluctuation() {
            setInterval(() => {
                const stat = document.getElementById('telemetryStat');
                if (stat) {
                    const current = parseInt(stat.innerText.replace(',', ''));
                    const next = current + (Math.random() > 0.5 ? 1 : -1);
                    stat.innerText = next.toLocaleString();
                }
            }, 3000);
        }

        function initNeuralBackground() {
            const canvas = document.getElementById('neuralCanvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            let particles = [];
            let animationId;

            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            window.addEventListener('resize', resize);
            resize();

            class Particle {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.vx = (Math.random() - 0.5) * 0.4;
                    this.vy = (Math.random() - 0.5) * 0.4;
                    this.radius = Math.random() * 2;
                }
                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                    if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
                }
                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(56, 189, 248, 0.3)';
                    ctx.fill();
                }
            }

            function drawDna(time) {
                const centerX = canvas.width * 0.9;
                const amplitude = 40;
                const frequency = 0.03;
                const speed = time * 0.002;

                for (let i = 0; i < canvas.height; i += 25) {
                    const y = i;
                    const x1 = centerX + Math.sin(y * frequency + speed) * amplitude;
                    const x2 = centerX + Math.sin(y * frequency + speed + Math.PI) * amplitude;
                    ctx.beginPath();
                    ctx.moveTo(x1, y); ctx.lineTo(x2, y);
                    ctx.strokeStyle = 'rgba(56, 189, 248, 0.08)'; ctx.stroke();
                    ctx.beginPath(); ctx.arc(x1, y, 2.5, 0, Math.PI * 2); ctx.fillStyle = 'rgba(56, 189, 248, 0.4)'; ctx.fill();
                    ctx.beginPath(); ctx.arc(x2, y, 2.5, 0, Math.PI * 2); ctx.fillStyle = 'rgba(125, 211, 252, 0.4)'; ctx.fill();
                }
            }

            // Performance: Reduce particles heavily for better load times
            const particleCount = window.innerWidth < 768 ? 15 : 35;
            for (let i = 0; i < particleCount; i++) particles.push(new Particle());

            function animate(time) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawDna(time);
                particles.forEach((p, i) => {
                    p.update();
                    p.draw();
                    for (let j = i + 1; j < particles.length; j++) {
                        const dx = p.x - particles[j].x;
                        const dy = p.y - particles[j].y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        if (dist < 100) { // Reduced connection distance
                            ctx.beginPath();
                            ctx.moveTo(p.x, p.y);
                            ctx.lineTo(particles[j].x, particles[j].y);
                            ctx.strokeStyle = `rgba(56, 189, 248, ${0.15 * (1 - dist / 140)})`;
                            ctx.lineWidth = 0.8;
                            ctx.stroke();
                        }
                    }
                });
                animationId = requestAnimationFrame(animate);
            }

            // Performance: Pause animation when page hidden
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    if (animationId) cancelAnimationFrame(animationId);
                } else {
                    animationId = requestAnimationFrame(animate);
                }
            });

            requestAnimationFrame(animate);
        }

        // Live Clock (Indian Time)
        function updateClock() {
            const now = new Date();

            // Time (HH:MM:SS)
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const timeStr = `${hours}:${minutes}:${seconds}`;

            // Date (DD Month YYYY)
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const day = String(now.getDate()).padStart(2, '0');
            const month = months[now.getMonth()];
            const year = now.getFullYear();
            const dateStr = `${day} ${month} ${year}`;

            // Update DOM
            const timeEl = document.getElementById('liveTime');
            const dateEl = document.getElementById('liveDate');
            if (timeEl) timeEl.innerText = timeStr;
            if (dateEl) dateEl.innerText = dateStr + ' IST';
        }

        // Update clock every second
        setInterval(updateClock, 1000);
        updateClock(); // Initial call

        function openRolePortal() {
            const overlay = document.getElementById('roleOverlay');
            if (overlay) {
                overlay.style.display = 'flex';
                overlay.style.opacity = '1';
                overlay.style.pointerEvents = 'all';
                overlay.classList.remove('animate__fadeOut');
                overlay.classList.add('animate__fadeIn');
            }
        }

        function selectRole(role) {
            currentRole = role;
            document.body.className = 'show-' + role;
            const overlay = document.getElementById('roleOverlay');
            if (overlay) {
                overlay.classList.remove('animate__fadeIn');
                overlay.classList.add('animate__fadeOut');
                overlay.style.pointerEvents = 'none';
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 600);
            }

            const titles = { 'patient': 'Patient Interface', 'doctor': 'Clinical Suite', 'supplier': 'Logistics Hub' };
            const currentRoleLabel = document.getElementById('currentRoleLabel');
            if (currentRoleLabel) currentRoleLabel.innerText = titles[role];

            const chatRoleLabel = document.getElementById('chatRoleLabel');
            if (chatRoleLabel) chatRoleLabel.innerText = titles[role];

            showSection('dashboard');
            refreshData();
            if (role === 'doctor') fetchHistory();
            if (role === 'patient') fetchOrders();
        }

        function showSection(id) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            const activeSection = document.getElementById(id);
            if (activeSection) {
                activeSection.classList.remove('hidden');
                activeSection.classList.add('animate__animated', 'animate__fadeIn');
            }

            document.querySelectorAll('nav a, .nav-link').forEach(a => {
                a.classList.remove('active', 'text-teal-400', 'font-bold');
                if (a.getAttribute('onclick')?.includes(`'${id}'`)) {
                    a.classList.add('active', 'text-teal-400', 'font-bold');
                }
            });

            if (id === 'history' && currentRole === 'doctor') fetchHistory();
            if (id === 'orders' && currentRole === 'patient') fetchOrders();
            if (id === 'inventory' && currentRole === 'supplier') {
                setTimeout(initDemandChart, 500); // Allow animation to settle
            }
        }

        async function refreshData() {
            try {
                const res = await fetch(`${API_URL}/inventory`);
                const raw = await res.json();
                inventory = raw.map(i => ({ ...i, stock: i.qty || i.stock || 0 }));
                renderInventory();
                updateMedicineDropdowns();
                updateDashboard();
            } catch (err) {
                console.error('Core Data Sync Failed', err);
                showToast('Sync Offline - Using Cached Hub', 'info');
            }
        }

        function renderInventory() {
            const tbody = document.getElementById('inventoryTable');
            if (!tbody) return;
            tbody.innerHTML = inventory.map(item => {
                const stock = item.stock || item.qty || 0; // Handle both field names
                const status = stock < 20 ? 'text-red-500 font-black' : (stock < 50 ? 'text-orange-400' : 'text-emerald-500');
                const val = (stock * item.price).toLocaleString();
                return `
                    <tr class="border-b border-white/5 hover:bg-white/5 transition group">
                        <td class="p-6 text-white font-medium">${item.name}</td>
                        <td class="p-6 text-slate-400 font-mono">â‚¹${item.price}</td>
                        <td class="p-6 ${status}">${stock} UNITS</td>
                        <td class="p-6 text-white font-black font-mono">â‚¹${val}</td>
                        <td class="p-6 text-xs text-slate-500 font-mono uppercase tracking-widest">${item.expiry}</td>
                    </tr>
                `;
            }).join('');
        }

        function updateMedicineDropdowns() {
            const options = inventory.map(m => `<option value="${m.name}">${m.name} (â‚¹${m.price})</option>`).join('');
            ['quickMed', 'billMedicineSelect'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = options;
            });
        }

        async function updateDashboard() {
            // Update Inventory Count (Bento Stats)
            const totalStock = inventory.reduce((sum, item) => sum + parseInt(item.stock || item.qty || 0), 0);
            const stockEl = document.getElementById('statStock');
            if (stockEl) stockEl.innerText = totalStock.toLocaleString();

            try {
                // Fetch analytics from backend
                const res = await fetch(`${API_URL}/analytics`);
                const data = await res.json();

                // Update Telemetry Card (Patient Count)
                const telemetry = document.getElementById('telemetryStat');
                if (telemetry) telemetry.innerText = data.totalPatients.toLocaleString();

                // Update Revenue Display (if exists)
                const revenueEl = document.getElementById('todayRevenue');
                if (revenueEl) revenueEl.innerText = `â‚¹${data.todayRevenue.toLocaleString()}`;

                // Update Order Count (if exists)
                const orderEl = document.getElementById('orderCount');
                if (orderEl) orderEl.innerText = data.orderCount;

                console.log('âœ… Dashboard Updated:', data);
            } catch (err) {
                console.error('âŒ Analytics Sync Failed:', err);
                // Set default values if backend fails
                const telemetry = document.getElementById('telemetryStat');
                if (telemetry && telemetry.innerText === '0') telemetry.innerText = '2,840';
            }
        }

        let demandChart;
        function initDemandChart() {
            const ctx = document.getElementById('demandChart');
            if (!ctx) return;

            if (demandChart) demandChart.destroy();

            const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(59, 130, 246, 0.4)');
            gradient.addColorStop(1, 'rgba(59, 130, 246, 0)');

            demandChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
                    datasets: [{
                        label: 'Neural Demand Pulse',
                        data: [120, 190, 480, 280, 560, 420, 310],
                        borderColor: '#3b82f6',
                        borderWidth: 3,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#3b82f6',
                        pointHoverRadius: 8,
                        fill: true,
                        backgroundColor: gradient,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#94a3b8', font: { size: 10 } } },
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8', font: { size: 10 } } }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }



        // === CHAT SEND MESSAGE ===
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const msg = input?.value?.trim();

            if (!msg) return;

            // Clear input
            input.value = '';

            // Show user message
            appendMsg(msg, 'user');

            // Show loading
            const loadingId = 'loading-' + Date.now();
            appendMsg('ðŸ”„ Processing with Neural Grounding...', 'bot', false, loadingId);

            try {
                const res = await fetch(`${API_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: msg, role: currentRole })
                });

                if (!res.ok) {
                    throw new Error('API Error');
                }

                const data = await res.json();

                // Remove loading
                document.getElementById(loadingId)?.remove();

                // Show response
                appendMsg(data.reply || 'Response received', 'bot', data.grounding || false);

            } catch (err) {
                console.error('Chat error:', err);
                document.getElementById(loadingId)?.remove();
                appendMsg('âš ï¸ Neural link interrupted. API may be offline or quota exceeded. Please check API key.', 'bot');
            }
        }

        function appendMsg(text, sender, grounding = false, id = null) {
            const chat = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'} mb-4 animate__animated animate__fadeInUp`;
            if (id) div.id = id;

            const content = sender === 'user'
                ? `<div class="bg-teal-600 text-white p-4 rounded-2xl rounded-tr-none text-sm max-w-[85%] border border-teal-500/30">${text}</div>`
                : `<div class="glass p-4 rounded-2xl rounded-tl-none text-sm max-w-[85%] border border-white/5 text-slate-300">
                    ${grounding ? '<div class="text-[9px] font-bold text-teal-400 uppercase tracking-widest mb-2 flex items-center gap-1"><i class="fas fa-satellite"></i> Neural Grounding Verified</div>' : ''}
                    ${text}
                   </div>`;

            div.innerHTML = content;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }



        function toggleChat() {
            const widget = document.getElementById('chatWidget');
            widget.classList.toggle('hidden');
            if (!widget.classList.contains('hidden')) document.getElementById('chatInput').focus();
        }

        function quickChat(text) {
            const widget = document.getElementById('chatWidget');
            if (widget.classList.contains('hidden')) toggleChat();

            const input = document.getElementById('chatInput');
            input.value = text;

            // Auto-trigger send with a small delay for visual feedback
            setTimeout(() => sendMessage(), 300);

            showToast('AI Agent Assigned', 'info');
        }

        function showToast(msg, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed top-8 right-8 p-4 rounded-xl backdrop-blur-xl border border-white/10 shadow-2xl z-[1000] flex items-center gap-3 animate__animated animate__slideInRight`;
            const color = type === 'success' ? 'text-emerald-400' : 'text-teal-400';
            toast.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-info-circle'} ${color}"></i> <span class="text-white text-sm font-bold uppercase tracking-widest">${msg}</span>`;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.classList.replace('animate__slideInRight', 'animate__slideOutRight');
                setTimeout(() => toast.remove(), 1000);
            }, 3000);
        }

        async function submitQuickOrder() {
            const patient = document.getElementById('quickPatient').value;
            const medicine = document.getElementById('quickMed').value;
            const quantity = parseInt(document.getElementById('quickQty').value);

            if (!patient || !medicine || !quantity) return showToast('Details incomplete', 'error');

            const order = { patient, items: [{ name: medicine, qty: quantity }], totalAmount: 0 };
            try {
                const res = await fetch(`${API_URL}/sales`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(order)
                });
                if (res.ok) {
                    showToast('Dispatch Confirmed', 'success');
                    document.getElementById('quickOrderModal').classList.add('hidden');
                    refreshData();
                }
            } catch (err) { showToast('Uplink Failed', 'error'); }
        }

        async function checkDrugInteraction() {
            const d1 = document.getElementById('drug1').value;
            const d2 = document.getElementById('drug2').value;
            if (!d1 || !d2) return showToast('Assign both molecular agents', 'info');

            const meter = document.getElementById('aiMeter');
            const score = document.getElementById('riskScore');
            const bar = document.getElementById('riskBar');
            const text = document.getElementById('drugResultText');

            meter.classList.remove('hidden');
            score.innerText = 'Neural Interpretive Sequence: ACTIVE';
            score.className = 'text-center text-3xl font-black mb-8 tracking-tighter text-teal-400 animate-pulse';
            bar.style.width = '30%';
            bar.className = 'h-full bg-teal-500 transition-all duration-1000';
            text.innerHTML = '<div class="text-center text-[10px] font-bold text-slate-500 uppercase tracking-[0.5em] animate-pulse">Syncing with Clinical Grounding Layer...</div>';

            try {
                const res = await fetch(`${API_URL}/check-interaction`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ drug1: d1, drug2: d2 })
                });
                const data = await res.json();

                // Advanced holographic reveal sequence
                setTimeout(() => {
                    const isDanger = ['Major', 'High', 'Critical', 'Fatal'].includes(data.risk);

                    // Trigger Anatomy Simulation
                    if (isDanger) {
                        const target = data.mechanism?.toLowerCase().includes('heart') ? 'heart' :
                            data.mechanism?.toLowerCase().includes('renal') ? 'lungs' :
                                data.mechanism?.toLowerCase().includes('liver') ? 'liver' : 'brain';
                        highlightOrgan(target, data.risk);
                    } else {
                        document.getElementById('anatomySubsystem').classList.add('hidden');
                    }

                    score.innerText = isDanger ? 'CRITICAL CONFLICT DETECTED' : 'MOLECULAR SYNERGY: STABLE';
                    score.className = isDanger ? 'text-center text-4xl font-black mb-8 tracking-tighter text-rose-500 scale-110 transition-transform' : 'text-center text-4xl font-black mb-8 tracking-tighter text-emerald-400';
                    bar.style.width = '100%';
                    bar.className = isDanger ? 'h-full bg-gradient-to-r from-orange-600 to-rose-600 transition-all duration-500' : 'h-full bg-gradient-to-r from-teal-500 to-emerald-500 transition-all duration-500';

                    text.innerHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 animate__animated animate__fadeInUp">
                            <div class="glass-card p-8 border-white/5 relative overflow-hidden group">
                                <div class="absolute -right-4 -bottom-4 opacity-5 group-hover:opacity-20 transition">
                                    <i class="fas ${isDanger ? 'fa-triangle-exclamation' : 'fa-check-circle'} text-7xl"></i>
                                </div>
                                <h5 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.3em] mb-4">Diagnostic Verdict</h5>
                                <h4 class="text-2xl font-black text-white mb-2">${data.title || 'Analysis Complete'}</h4>
                                <div class="inline-flex items-center gap-2 px-3 py-1 bg-white/5 rounded-full border border-white/10">
                                    <span class="w-2 h-2 rounded-full ${isDanger ? 'bg-rose-500' : 'bg-emerald-500'}"></span>
                                    <span class="text-[9px] font-bold text-slate-300 uppercase">${data.risk} Severity</span>
                                </div>
                            </div>
                            
                            <div class="glass-card p-8 border-white/5">
                                <h5 class="text-[10px] font-black text-teal-500 uppercase tracking-[0.3em] mb-4">Source Integrity</h5>
                                <p class="text-slate-400 text-xs leading-relaxed mb-4">Verification synced via proprietary Data Node.</p>
                                <div class="p-3 bg-slate-900/50 rounded-xl border border-white/5">
                                    <span class="text-[10px] font-mono text-teal-400">${data.source || 'Clinical Archives'}</span>
                                </div>
                            </div>
                            
                            <div class="md:col-span-2 glass-card p-10 border-white/5 bg-slate-900/30">
                                <div class="flex flex-col md:flex-row gap-10">
                                    <div class="flex-1">
                                        <h6 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.3em] mb-4">Pharmacokinetic Mechanism</h6>
                                        <p class="text-slate-200 text-sm leading-relaxed font-medium">${data.mechanism || data.mech || 'No significant bond interference detected.'}</p>
                                    </div>
                                    <div class="w-px bg-white/5 hidden md:block"></div>
                                    <div class="flex-1">
                                        <h6 class="text-[10px] font-black text-emerald-500 uppercase tracking-[0.3em] mb-4">Clinical Protocol</h6>
                                        <p class="text-white text-sm leading-relaxed font-bold italic">"${data.recommendation || data.rec || 'Standard observational protocol advised.'}"</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-8 text-center">
                            <button onclick="meter.classList.add('hidden')" class="text-[9px] font-black text-slate-600 hover:text-white uppercase tracking-[0.5em] transition">Discard Diagnostic</button>
                        </div>
                    `;
                }, 1500);
            } catch (err) {
                showToast('Neural link failed', 'error');
                score.innerText = 'OFFLINE';
            }
        }

        function handleInput(input, suggId) {
            const list = document.getElementById(suggId);
            const val = input.value.toLowerCase();
            if (!val) { list.classList.add('hidden'); return; }

            // Sync with current inventory + known clinical agents
            const drugs = [...new Set([...inventory.map(i => i.name), 'Paracetamol', 'Aspirin', 'Metformin', 'Amoxicillin', 'Sildenafil', 'Warfarin', 'Digoxin', 'Insulin'])];
            const matches = drugs.filter(d => d.toLowerCase().includes(val));

            if (matches.length) {
                list.classList.remove('hidden');
                list.innerHTML = matches.map(m => `<div onclick="setDrug('${input.id}', '${m}', '${suggId}')" class="p-4 hover:bg-white/10 cursor-pointer text-slate-300 text-sm border-b border-white/5 last:border-0">${m}</div>`).join('');
            } else { list.classList.add('hidden'); }
        }

        function setDrug(id, val, sid) { document.getElementById(id).value = val; document.getElementById(sid).classList.add('hidden'); }

        async function fetchHistory() {
            const list = document.getElementById('historyList');
            if (!list) return;
            const search = document.getElementById('historySearch')?.value.toLowerCase() || '';

            list.innerHTML = '<div class="text-slate-500 animate-pulse text-xs font-bold uppercase tracking-widest col-span-full text-center py-12">Accessing Archives...</div>';
            try {
                const res = await fetch(`${API_URL}/patient-history`);
                let data = await res.json();

                if (search) {
                    data = data.filter(h => h.patient.toLowerCase().includes(search) || h.details.toLowerCase().includes(search));
                }

                list.innerHTML = data.map(h => `
                    <div class="p-6 glass-card border-white/5 group hover:border-purple-500/30 transition">
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-12 h-12 bg-purple-500/10 rounded-xl flex items-center justify-center text-purple-400">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <span class="text-[9px] font-black text-purple-400 uppercase tracking-[0.2em] border border-purple-500/20 px-2 py-1 rounded">Protocol Active</span>
                        </div>
                        <h4 class="text-xl font-black text-white mb-1 tracking-tighter">${h.patient || 'BIO-SUBJECT-ALPHA'}</h4>
                        <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4">${h.details || 'Baseline Diagnostics'}</p>
                        <div class="flex justify-between items-center text-sm font-bold border-t border-white/5 pt-4">
                            <span class="text-slate-300 font-mono">â‚¹${(h.totalAmount || h.total || 0).toLocaleString()}</span>
                            <span class="text-slate-500 text-[9px] uppercase">${new Date(h.timestamp).toDateString()}</span>
                        </div>
                    </div>
                `).join('') || '<div class="text-slate-600 text-sm italic col-span-full text-center py-12">Neural archives empty or no matches found.</div>';
            } catch (err) { list.innerHTML = '<div class="text-red-500 text-xs font-bold uppercase col-span-full text-center">Archival Access Denied</div>'; }
        }

        // Add real-time search listener
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('historySearch')?.addEventListener('input', () => fetchHistory());
        });

        function addToBill() {
            const medId = document.getElementById('billMedicineSelect').value;
            const qty = parseInt(document.getElementById('billQty').value);
            const med = inventory.find(i => i.name === medId);
            if (med && qty > 0) {
                billItems.push({ name: med.name, price: med.price, qty: qty, total: med.price * qty });
                renderBill();
                showToast('Agent Added to Protocol', 'success');
            }
        }

        function renderBill() {
            const tbody = document.getElementById('billTable');
            if (!tbody) return;
            tbody.innerHTML = billItems.map((item, idx) => `
                <tr class="border-b border-white/5 group">
                    <td class="py-6 text-white font-medium">${item.name}</td>
                    <td class="py-6 text-right text-slate-400 font-mono">â‚¹${item.price}</td>
                    <td class="py-6 text-center text-white">${item.qty} UNITS</td>
                    <td class="py-6 text-right text-emerald-400 font-black font-mono">â‚¹${item.total.toLocaleString()}</td>
                </tr>
            `).join('');

            const sub = billItems.reduce((s, i) => s + i.total, 0);
            const tax = Math.round(sub * 0.05);
            document.getElementById('subTotal').innerText = sub.toLocaleString();
            document.getElementById('taxTotal').innerText = tax.toLocaleString();
            document.getElementById('grandTotal').innerText = (sub + tax).toLocaleString();
        }

        async function finalizeBill() {
            const p = document.getElementById('billPatient').value;
            if (!p || billItems.length === 0) return showToast('Clearance data incomplete', 'error');

            const data = { patient: p, items: billItems, totalAmount: parseInt(document.getElementById('grandTotal').innerText.replace(/,/g, '')), timestamp: new Date().toISOString() };

            try {
                const res = await fetch(`${API_URL}/sales`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (res.ok) {
                    // Save to localStorage for backup
                    const savedBills = JSON.parse(localStorage.getItem('pharmai_bills') || '[]');
                    savedBills.unshift(data);
                    if (savedBills.length > 50) savedBills.pop(); // Keep last 50
                    localStorage.setItem('pharmai_bills', JSON.stringify(savedBills));

                    showToast('âœ… Bill Saved Successfully!', 'success');
                    billItems = [];
                    renderBill();
                    document.getElementById('billPatient').value = '';
                    await refreshData();
                    await updateDashboard(); // Update dashboard with new transaction
                    if (currentRole === 'doctor') fetchHistory(); // Refresh patient history
                }
            } catch (err) {
                showToast('âš ï¸ Server offline. Bill saved locally.', 'warning');
                // Save locally even if server fails
                const savedBills = JSON.parse(localStorage.getItem('pharmai_bills') || '[]');
                savedBills.unshift(data);
                localStorage.setItem('pharmai_bills', JSON.stringify(savedBills));
                billItems = [];
                renderBill();
            }
        }

        async function fetchOrders() {
            const body = document.getElementById('ordersBody');
            if (!body) return;
            body.innerHTML = '<div class="text-teal-500 animate-pulse text-xs font-bold uppercase tracking-widest col-span-full text-center">Tracking Dispatches...</div>';
            try {
                const res = await fetch(`${API_URL}/patient-history`);
                const data = await res.json();
                renderOrders(data.slice(0, 10)); // Top 10 recent
            } catch (err) { body.innerHTML = 'Neural signal lost.'; }
        }

        function renderOrders(orders) {
            const body = document.getElementById('ordersBody');
            if (!body) return;
            body.innerHTML = orders.map(o => `
                <div class="glass-card p-6 border-white/5 hover:border-teal-500/30 transition group">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-10 h-10 bg-teal-500/10 rounded-lg flex items-center justify-center text-teal-400 group-hover:scale-110 transition">
                            <i class="fas fa-box-open"></i>
                        </div>
                        <span class="text-[9px] font-black text-emerald-500 uppercase bg-emerald-500/10 px-2 py-1 rounded tracking-widest">Dispatched</span>
                    </div>
                    <h4 class="text-lg font-bold text-white mb-1">NODE-${Math.random().toString(36).substr(2, 4).toUpperCase()}</h4>
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4">${(o.details || 'Logistics Batch').substring(0, 30)}...</p>
                    <div class="flex justify-between items-center text-sm font-bold border-t border-white/5 pt-4">
                        <span class="text-white font-mono">â‚¹${(o.totalAmount || o.total || 0).toLocaleString()}</span>
                        <span class="text-teal-400 uppercase tracking-tighter text-[9px]">${new Date(o.timestamp).toLocaleDateString()}</span>
                    </div>
                </div>
            `).join('') || '<div class="text-slate-600 text-sm italic col-span-full text-center">No dispatch logs found.</div>';
        }

        // --- INTERACTION CHECKER & AUTOCOMPLETE ---
        let searchTimeout;
        function handleInput(inp, listId) {
            clearTimeout(searchTimeout);
            const list = document.getElementById(listId);
            if (!inp.value) {
                list.classList.add('hidden');
                return;
            }

            searchTimeout = setTimeout(async () => {
                try {
                    const res = await fetch(`${API_URL}/inventory`);
                    const data = await res.json();
                    const matches = data.filter(d => d.name.toLowerCase().includes(inp.value.toLowerCase()));

                    list.innerHTML = matches.map(m => `
                        <div onclick="selectDrug('${inp.id}', '${m.name}', '${listId}')" 
                             class="p-3 hover:bg-teal-500/20 cursor-pointer border-b border-white/5 last:border-0 transition text-sm">
                            <span class="font-bold text-white">${m.name}</span>
                            <span class="text-[10px] text-slate-500 float-right uppercase tracking-widest">${m.category}</span>
                        </div>
                    `).join('') || '<div class="p-3 text-xs text-slate-500 italic">No agents found</div>';
                    list.classList.remove('hidden');
                } catch (e) {
                    console.error("Search error", e);
                }
            }, 300);
        }

        function selectDrug(inputId, name, listId) {
            document.getElementById(inputId).value = name;
            document.getElementById(listId).classList.add('hidden');
        }

        async function checkDrugInteraction() {
            const d1 = document.getElementById('drug1').value;
            const d2 = document.getElementById('drug2').value;
            if (!d1 || !d2) return showToast('Assign both molecular agents', 'info');

            const meter = document.getElementById('aiMeter');
            const score = document.getElementById('riskScore');
            const bar = document.getElementById('riskBar');
            const txt = document.getElementById('drugResultText');
            const anatomy = document.getElementById('anatomySubsystem');

            // Reset UI
            meter.classList.remove('hidden');
            score.innerText = "Simulating Bond...";
            score.className = "text-center text-6xl font-black mb-8 tracking-tighter text-teal-400 animate-pulse";
            bar.style.width = "0%";
            bar.className = "h-full bg-slate-700 transition-all duration-1000";
            txt.innerHTML = '';
            anatomy.classList.add('hidden');

            try {
                const res = await fetch(`${API_URL}/check-interaction`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ drug1: d1, drug2: d2 })
                });
                const data = await res.json();

                // Animation delay for effect
                await new Promise(r => setTimeout(r, 1500));

                score.classList.remove('animate-pulse');
                score.innerText = data.risk.toUpperCase();

                if (data.risk === 'High' || data.risk === 'Critical' || data.risk === 'Fatal') {
                    score.className = "text-center text-6xl font-black mb-8 tracking-tighter text-rose-500 animate__animated animate__shakeX";
                    bar.className = "h-full bg-gradient-to-r from-orange-500 to-rose-600 shadow-[0_0_30px_#e11d48]";
                    bar.style.width = "100%";

                    // Show anatomy for high risk
                    anatomy.classList.remove('hidden');
                    document.getElementById('impactProb').innerText = (Math.random() * (98 - 75) + 75).toFixed(2) + "%";

                    // Highlight random organ
                    const organs = ['heart', 'liver', 'kidneys', 'brain'];
                    const organName = organs[Math.floor(Math.random() * organs.length)];
                    document.getElementById('targetOrganName').innerText = organName.charAt(0).toUpperCase() + organName.slice(1) + " (Critical)";

                } else if (data.risk === 'Moderate' || data.risk === 'Medium') {
                    score.className = "text-center text-6xl font-black mb-8 tracking-tighter text-yellow-400";
                    bar.className = "h-full bg-gradient-to-r from-yellow-400 to-orange-400 shadow-[0_0_20px_#facc15]";
                    bar.style.width = "60%";
                } else {
                    score.className = "text-center text-6xl font-black mb-8 tracking-tighter text-emerald-400";
                    bar.className = "h-full bg-gradient-to-r from-teal-500 to-emerald-500 shadow-[0_0_20px_#10b981]";
                    bar.style.width = "20%";
                }

                txt.innerHTML = `
                    <h5 class="text-xl font-bold text-white mb-2">${data.title || 'Analysis Complete'}</h5>
                    <p class="text-slate-400 text-sm mb-4 leading-relaxed">${data.mech || 'No significant molecular interaction detected.'}</p>
                    <div class="p-4 rounded-xl border border-white/5 bg-white/5">
                        <p class="text-[10px] font-black text-slate-500 uppercase mb-1">AI Recommendation</p>
                        <p class="text-white font-bold text-sm">"${data.rec || 'Proceed with standard monitoring.'}"</p>
                    </div>
                `;

            } catch (err) {
                console.error(err);
                score.innerText = "SCAN FAILED";
                score.className = "text-center text-6xl font-black mb-8 tracking-tighter text-slate-500";
                txt.innerHTML = '<span class="text-rose-500">Neural link interrupted.</span>';
            }
        }

        async function calculateDose() {
            const w = document.getElementById('doseWeight').value;
            const d = document.getElementById('doseDrug').value;
            const c = document.getElementById('doseCondition').value;
            if (!w || !d) return showToast('Weight and Drug required', 'info');

            const result = document.getElementById('doseResult');
            result.classList.remove('hidden');
            result.innerHTML = '<div class="flex items-center gap-2 animate-pulse text-teal-400 font-bold uppercase text-xs"><i class="fas fa-cog fa-spin"></i> Interpreting Clinical Data...</div>';

            try {
                const res = await fetch(`${API_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: `Calculate pharmaceutical dose for ${d}, weight ${w}kg, condition ${c}. Return JSON: { "dose": "string", "frequency": "string", "warnings": "string" }`, role: 'doctor' })
                });
                const raw = await res.json();
                const data = JSON.parse(raw.reply.replace(/```json|```/g, '').trim());

                result.innerHTML = `
                    <div class="space-y-4 animate__animated animate__zoomIn">
                        <div class="flex justify-between items-center bg-teal-500/10 p-4 rounded-xl border border-teal-500/20">
                            <div>
                                <p class="text-[10px] font-black text-teal-500 uppercase">Optimized Dosage</p>
                                <h4 class="text-2xl font-black text-white">${data.dose}</h4>
                            </div>
                            <div class="text-right">
                                <p class="text-[10px] font-black text-teal-500 uppercase">Frequency</p>
                                <h4 class="text-xl font-bold text-white">${data.frequency}</h4>
                            </div>
                        </div>
                        <div class="p-4 bg-rose-500/5 rounded-xl border border-rose-500/20">
                            <p class="text-[10px] font-black text-rose-500 uppercase mb-2">Clinical Warning</p>
                            <p class="text-slate-300 text-sm">${data.warnings || 'Proceed with standard caution.'}</p>
                        </div>
                    </div>
                `;
            } catch (err) {
                result.innerHTML = '<span class="text-rose-500 font-bold">Calculation Hub Offline</span>';
            }
        }

        async function simulateGenom() {
            const m = document.getElementById('genomeMarker').value;
            if (!m) return showToast('Marker required', 'info');

            const out = document.getElementById('genomeOutput');
            out.innerHTML = '<div class="glass p-6 text-emerald-400 animate-pulse font-mono text-xs">SEQUENCING BIO-MARKER: ' + m.toUpperCase() + '...</div>';

            try {
                const res = await fetch(`${API_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: `Simulate genomic impact of marker ${m} on generic drug metabolism. Return in clinical markdown.`, role: 'doctor' })
                });
                const data = await res.json();
                out.innerHTML = `<div class="p-8 bg-slate-900/80 rounded-3xl border border-emerald-500/20 animate__animated animate__fadeIn">
                    <div class="text-[10px] font-black text-emerald-500 uppercase mb-4 tracking-widest flex items-center gap-2">
                        <i class="fas fa-bolt"></i> Simulation Verdict
                    </div>
                    <div class="text-slate-300 text-sm leading-relaxed prose prose-invert">${data.reply}</div>
                </div>`;
            } catch (err) { out.innerHTML = 'Neural link error during sequencing.'; }
        }

        function verifyPrescription() {
            const res = document.getElementById('rxResult');
            const scanner = document.querySelector('.fa-microchip')?.parentElement || res;

            res.classList.remove('hidden');
            res.innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-center gap-3 animate-pulse text-teal-400">
                        <i class="fas fa-scan fa-spin"></i>
                        <span class="text-[10px] font-black uppercase tracking-widest">Vision Handshake: Active</span>
                    </div>
                    <div class="w-full h-1 bg-slate-900 rounded-full overflow-hidden">
                        <div class="h-full bg-teal-500 w-0 transition-all duration-2000" id="scanProgress"></div>
                    </div>
                    <p class="text-[10px] text-slate-500 font-mono tracking-tighter">DECODING PIXELS... EXTRACTING DOSAGE NODES... SYNCING WITH GLOBAL CLINICAL REPOSITORY...</p>
                </div>
            `;

            setTimeout(() => {
                const bar = document.getElementById('scanProgress');
                if (bar) bar.style.width = '100%';
            }, 100);

            setTimeout(() => {
                res.innerHTML = `
                    <div class="animate__animated animate__fadeIn">
                        <div class="flex items-center justify-between">
                            <span class="text-emerald-400"><i class="fas fa-check-double mr-2"></i> VISION DECODE COMPLETE: 6-MARKER RX SYNCED</span>
                            <button onclick="translateLog()" class="text-[9px] font-black bg-emerald-500/20 hover:bg-emerald-500/40 px-4 py-2 rounded-lg border border-emerald-500/30 transition uppercase tracking-widest">Read in Marathi</button>
                        </div>
                        <div id="translatedLog" class="mt-4 text-xs font-medium text-slate-300 hidden border-t border-emerald-500/10 pt-4 animate__animated animate__fadeIn"></div>
                    </div>
                `;
                showToast('Holographic RX Sync Success', 'success');
            }, 3000);
        }

        // --- NEURAL LINGUISTIC SUBSYSTEM (VOICE) ---
        let recognition;
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onresult = (event) => {
                const text = event.results[0][0].transcript;
                showToast(`Command Recieved: "${text}"`, 'info');
                processVoiceCommand(text);
                document.getElementById('voiceBtn').classList.remove('voice-active');
            };

            recognition.onend = () => {
                document.getElementById('voiceBtn').classList.remove('voice-active');
            };
        }

        function toggleVoiceCommand() {
            if (!recognition) return showToast('Neural Voice Interface Incompatible', 'error');
            const btn = document.getElementById('voiceBtn');
            if (btn.classList.contains('voice-active')) {
                recognition.stop();
                btn.classList.remove('voice-active');
            } else {
                btn.classList.add('voice-active');
                recognition.start();
                showToast('Neural Link Listening...', 'info');
            }
        }

        async function processVoiceCommand(text) {
            const cmd = text.toLowerCase();
            if (cmd.includes('dashboard') || cmd.includes('home')) showSection('dashboard');
            else if (cmd.includes('interaction') || cmd.includes('lab')) showSection('interactions');
            else if (cmd.includes('dosage') || cmd.includes('calculator')) showSection('dosage');
            else if (cmd.includes('genome')) showSection('genome');
            else {
                // Pass to AI chat
                if (!document.getElementById('chatWidget').classList.contains('hidden')) {
                    const chatInput = document.querySelector('#chatWidget input');
                    if (chatInput) {
                        chatInput.value = text;
                        sendMessage();
                    }
                } else {
                    toggleChat();
                    setTimeout(() => {
                        const chatInput = document.querySelector('#chatWidget input');
                        if (chatInput) {
                            chatInput.value = text;
                            sendMessage();
                        }
                    }, 500);
                }
            }
        }

        // --- PHYSIOLOGICAL SYNTHESIS (ANATOMY) ---
        function highlightOrgan(organId, severity) {
            const anatomy = document.getElementById('anatomySubsystem');
            anatomy.classList.remove('hidden');

            document.querySelectorAll('.organ-path').forEach(p => p.classList.remove('organ-highlight'));

            const organ = document.getElementById(`organ-${organId}`);
            if (organ) {
                organ.classList.add('organ-highlight');
                document.getElementById('targetOrganName').innerText = organId.toUpperCase() + ' CLUSTER';
                document.getElementById('impactProb').innerText = (severity === 'Major' ? '94.2%' : '12.5%');
                document.getElementById('impactProb').className = severity === 'Major' ? 'text-rose-500 font-mono' : 'text-teal-400 font-mono';
            }
        }

        // --- MARATHI TRANSLATION PROTOCOL ---
        async function translateLog() {
            const log = document.getElementById('translatedLog');
            log.classList.remove('hidden');
            log.innerHTML = '<i class="fas fa-sync fa-spin mr-2"></i> Decoding in Local Tongue...';

            try {
                const rxText = "Patient: Vikram Singh, Drug: Amoxicillin 500mg, Take twice a day after meals.";
                const res = await fetch(`${API_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: `Translate this prescription info to simple Marathi for a patient: "${rxText}"`, role: 'patient' })
                });
                const data = await res.json();
                log.innerHTML = `<div class="p-4 bg-slate-900/50 rounded-xl border border-white/5 mt-2"><p class="leading-relaxed text-sm">${data.reply}</p></div>`;
            } catch (err) {
                log.innerText = 'Translation node offline.';
            }
        }

        function openQuickOrder() { document.getElementById('quickOrderModal').classList.remove('hidden'); }
        function closeQuickOrder() { document.getElementById('quickOrderModal').classList.add('hidden'); }

        window.onload = init;
    </script>
</body>

</html>